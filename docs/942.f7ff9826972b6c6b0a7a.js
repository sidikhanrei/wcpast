(self.webpackChunkwachatpro_webclient=self.webpackChunkwachatpro_webclient||[]).push([[942],{47908:(t,e,i)=>{"use strict";i.d(e,{i:()=>o});var n=i(37716),s=i(42448),a=i(39895),l=i(37624);let o=(()=>{class t{constructor(t,e){this.core=t,this.router=e,this.SelectedInstance={}}ngOnInit(){const t=this.core.getLS("SelectedInstance");t?(this.SelectedInstance=t,this.core.removeLS("SelectedInstance")):this.router.navigate(["/multiuser"]),console.log(this.SelectedInstance)}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.Q),n.Y36(a.F0))},t.\u0275cmp=n.Xpm({type:t,selectors:[["wa-chat-container"]],decls:1,vars:1,consts:[[1,"h-fullx","w-fullx",3,"instance"]],template:function(t,e){1&t&&n._UZ(0,"wa-chat-list",0),2&t&&n.Q6J("instance",e.SelectedInstance)},directives:[l.u],encapsulation:2}),t})()},37624:(t,e,i)=>{"use strict";i.d(e,{u:()=>J});var n=i(16304),s=i(23815),a=i.n(s),l=i(16738),o=i.n(l),r=i(37716),c=i(42448),u=i(51095),d=i(76627),h=i(71386),f=i(38583),g=i(88030),m=i(70346),p=i(23402);function x(t,e){1&t&&(r.ynx(0),r._UZ(1,"div",38),r.BQk())}function v(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"img",39),r.NdJ("error",function(){return r.CHM(t),r.oxw().$implicit.profilpic=null}),r.qZA()}if(2&t){const t=r.oxw().$implicit;r.Q6J("src",t.profilpic,r.LSH)}}function b(t,e){if(1&t&&r._UZ(0,"div",40),2&t){const t=r.oxw().$implicit;r.Q6J("matBadge",t.unreadCount)}}function Z(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit,e=r.oxw(2);r.xp6(1),r.hij(" ",e.showTime(null==t||null==t.last_chat?null:t.last_chat.timestamp)," ")}}function w(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit,e=r.oxw(2);r.xp6(1),r.hij(" ",e.showTime(null==t?null:t.timestamp)," ")}}function y(t,e){if(1&t&&(r.TgZ(0,"div",41),r._UZ(1,"mat-icon",42),r.qZA()),2&t){const t=r.oxw().$implicit;r.Q6J("ngClass",3===(null==t||null==t.last_chat?null:t.last_chat.ack)?"text-blue-600":"text-gray-400")}}function A(t,e){if(1&t&&r._UZ(0,"span",43),2&t){const t=r.oxw().$implicit,e=r.oxw(2);r.Q6J("innerHTML",e.toHtml(null==t||null==t.last_chat?null:t.last_chat.body),r.oJD)}}function S(t,e){if(1&t&&r._UZ(0,"span",43),2&t){const t=r.oxw(2).$implicit,e=r.oxw(2);r.Q6J("innerHTML",e.toHtml(t.last_chat.body),r.oJD)}}function T(t,e){1&t&&(r.TgZ(0,"span"),r._uU(1," Media "),r.qZA())}function _(t,e){if(1&t&&(r.TgZ(0,"span"),r.TgZ(1,"div",34),r.TgZ(2,"div",44),r._UZ(3,"mat-icon",45),r.qZA(),r.TgZ(4,"div",36),r.YNc(5,S,1,1,"span",37),r.YNc(6,T,2,0,"span",19),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(5),r.Q6J("ngIf",null==t||null==t.last_chat?null:t.last_chat.body),r.xp6(1),r.Q6J("ngIf",!(null!=t&&null!=t.last_chat&&t.last_chat.body))}}function q(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div",25),r.NdJ("click",function(){const e=r.CHM(t).$implicit;return r.oxw(2).Select(e)}),r.TgZ(1,"div",26),r.YNc(2,x,2,0,"ng-container",19),r.TgZ(3,"div",27),r.YNc(4,v,1,1,"img",28),r.qZA(),r.qZA(),r.TgZ(5,"div",29),r.YNc(6,b,1,1,"div",30),r.TgZ(7,"div",31),r.YNc(8,Z,2,1,"span",19),r.YNc(9,w,2,1,"span",19),r.qZA(),r.TgZ(10,"div",32),r._uU(11),r.qZA(),r.TgZ(12,"div",33),r.TgZ(13,"div",34),r.YNc(14,y,2,1,"div",35),r.TgZ(15,"div",36),r.YNc(16,A,1,1,"span",37),r.YNc(17,_,7,2,"span",19),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&t){const t=e.$implicit,i=r.oxw(2);r.Q6J("ngClass",t.id==i.chat.id?"bg-gray-100":""),r.xp6(2),r.Q6J("ngIf",t.unreadCount>0&&!(null!=t&&null!=t.last_chat&&t.last_chat.fromMe)),r.xp6(2),r.Q6J("ngIf",t.profilpic),r.xp6(2),r.Q6J("ngIf",(null==t?null:t.unreadCount)>0),r.xp6(2),r.Q6J("ngIf",null==t||null==t.last_chat?null:t.last_chat.timestamp),r.xp6(1),r.Q6J("ngIf",!(null!=t&&null!=t.last_chat&&t.last_chat.timestamp)),r.xp6(2),r.hij(" ",i.showName(t)," "),r.xp6(1),r.Q6J("ngClass",t.unreadCount>0&&(null==t||null==t.last_chat||!t.last_chat.fromMe)?"text-primary font-semibold":""),r.xp6(2),r.Q6J("ngIf",null==t||null==t.last_chat?null:t.last_chat.fromMe),r.xp6(2),r.Q6J("ngIf",!(null!=t&&null!=t.last_chat&&t.last_chat.hasMedia)),r.xp6(1),r.Q6J("ngIf",null==t||null==t.last_chat?null:t.last_chat.hasMedia)}}function I(t,e){if(1&t&&(r.ynx(0),r.YNc(1,q,18,11,"div",24),r.BQk()),2&t){const t=r.oxw();r.xp6(1),r.Q6J("ngForOf",t.List)}}function k(t,e){1&t&&(r.TgZ(0,"div",46),r._UZ(1,"mat-icon",47),r.TgZ(2,"div",48),r._uU(3," No chats "),r.qZA(),r.qZA()),2&t&&(r.xp6(1),r.Q6J("svgIcon","iconsmind:speach_bubble"))}function C(t,e){1&t&&(r.TgZ(0,"div",49),r._UZ(1,"mat-icon",47),r.TgZ(2,"div",48),r._uU(3,"Select a conversation or start a new chat"),r.qZA(),r.qZA()),2&t&&(r.xp6(1),r.Q6J("svgIcon","iconsmind:speach_bubble"))}function Y(t,e){if(1&t&&r._UZ(0,"wa-conversation",50),2&t){const t=r.oxw();r.Q6J("instance",t.instance)("chat",t.chat)}}let J=(()=>{class t{constructor(t){this.core=t,this.AllSub={},this.instance={},this.LastInstance={},this.List=[],this.aktifTimer=6e4,this.Updated=!0,this.NoChat=[],this.domList=100,this.Limit=100,this.Busy=!1,this.chat={}}ngOnInit(){let t=100;if(this.LastInstance.id!=this.instance.id&&(this.LastInstance=this.instance,this.List=[],t=500,Object.keys(this.AllSub).length>0))for(let e in this.AllSub)this.AllSub[e]&&(this.AllSub[e].unsubscribe(),console.log("detroy",e));setTimeout(()=>{this.loadData()},t)}ngOnDestroy(){if(this.core.stopAktif(),Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&(this.AllSub[t].unsubscribe(),console.log("detroy",t))}initSnapshot(t=!1){var e=this;return(0,n.Z)(function*(){if(!e.AllSub.chats){e.core.watchAktif(e.instance);let t=10;"loadNewList"==e.core.sharingTemp&&(t=100,e.core.sharingTemp=null);const i=yield e.core.FS.collection(e.instance.insid+"-chat-list",e=>e.limit(t).orderBy("timestamp","desc"));e.AllSub.chats=yield i.snapshotChanges().subscribe(i=>{let n=i.map(t=>t.payload.doc.data());n=a().filter(n,t=>t.timestamp),n=a().orderBy(n,["timestamp"],["desc"]),e.updateStorage(n,"chat-list-"+e.instance.insid,i=>{i[0].timestamp!=e.List[0].timestamp&&e.loadData(),e.Updated=!0,100==t&&(e.AllSub.chats.unsubscribe(),e.AllSub.chats=null,e.initSnapshot())})})}})()}Select(t){t.id!=this.chat.id&&(this.chat={},setTimeout(()=>{this.chat=t},100))}updateStorage(t,e=this.instance.insid+"-chat-list",i=null){this.core.getStorage({id:e,isjson:!0}).then(n=>{let s=t;if(n){for(let t of s)n=a().filter(n,e=>e.id._serialized!=t.id._serialized&&e.timestamp);s=[...s,...n]}s=a().orderBy(s,["timestamp"],["desc"]),this.core.setStorage({id:e,isjson:!0},s).then(()=>{i&&i(s)})})}loadData(){var t=this;clearTimeout(this.delayLoadData),this.delayLoadData=setTimeout(()=>{var e;this.instance&&(null===(e=this.instance)||void 0===e?void 0:e.insid)&&this.core.getStorage({id:"chat-list-"+this.instance.insid,isjson:!0}).then(function(){var e=(0,n.Z)(function*(e){if(e){var i=e.slice(0,t.Limit);t.List=i,t.extractNoChat()}});return function(t){return e.apply(this,arguments)}}())},10)}extractNoChat(){var t=this;this.busyNoChat&&!this.AllSub.snapshotCmdExract||this.core.getStorage({id:"chat-list-"+this.instance.insid,isjson:!0}).then(function(){var e=(0,n.Z)(function*(e){let i=a().filter(e,t=>!t.last_chat),s=[],l=0;for(let t of i){if(l>=10)break;s.push(t.id._serialized),l++}if(s.length<=0)return void t.initSnapshot();let o={phone:t.instance.insid,cmd:"getdetail",user:s,time:null},r=yield t.core.FS.collection(t.instance.insid+"-command",t=>t.limit(1)).doc(t.instance.insid);yield r.set(o),t.AllSub.snapshotCmdExtract=yield t.core.FS.collection(t.instance.insid+"-command",t=>t.limit(1)).doc(t.instance.insid).snapshotChanges().subscribe(function(){var e=(0,n.Z)(function*(e){e.payload.data().time&&(t.AllSub.snapshotCmdExtract.unsubscribe(),yield t.core.FS.collection(t.instance.insid+"-chat-list",t=>t.where("id._serialized","in",s).limit(s.length)).get().subscribe(e=>{let i=e.docs.map(t=>t.data());i.length>0&&t.updateStorage(i,"chat-list-"+t.instance.insid,()=>{t.loadData()})}))});return function(t){return e.apply(this,arguments)}}())});return function(t){return e.apply(this,arguments)}}())}showName(t){return t.name?t.name:t.pushname?t.pushname:t.number}showTime(t){let e,i=o()(o().unix(t)).format("YYYYMMDD"),n=o()(o()(new Date)).format("YYYYMMDD"),s=o()(o()(new Date)).subtract(1,"days").format("YYYYMMDD");return e=i!=n?i==s?this.core.translatePipe("yesterday"):o().unix(t).format("M/D/YY"):o().unix(t).format("HH:mm"),e}toHtml(t){if(t)return t=t.replace(/(?:\\[rn])+/g," "),this.core.text2html(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(c.Q))},t.\u0275cmp=r.Xpm({type:t,selectors:[["wa-chat-list"]],inputs:{instance:"instance"},decls:29,vars:11,consts:[[1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-hidden"],[1,"flex-auto","h-full"],[1,"flex","flex-col","overflow-hidden","h-full"],[1,"flex","flex-auto","overflow-hidden","border","h-full"],[1,"flex","flex-row","flex-auto"],[1,"relative","flex","bg-card","dark:bg-transparent","border-r"],[1,"flex","overflow-hidden"],[1,"relative","flex","flex-auto","flex-col","w-full","min-w-0","lg:min-w-100","lg:max-w-100","bg-card","dark:bg-transparent"],[1,"flex","flex-col","flex-0","py-4","px-8","border-b","bg-gray-700","dark:bg-transparent"],[1,"flex","items-center"],[1,"flex","items-center","mr-1","cursor-pointer","pl-7x"],[1,"w-12","h-12"],[1,"flex","items-center","justify-center","w-full","h-full","rounded-full","text-xl","uppercase","bg-gray-200","text-gray-600","dark:bg-gray-700","dark:text-gray-200"],[1,"ml-4","font-medium","truncate","text-gray-50"],[1,"text-sm"],["mat-icon-button","",1,"ml-auto"],[1,"icon-size-8","text-gray-50",3,"svgIcon"],["customVirtualScrollStrategy","","minBufferPx","1000","maxBufferPx","1500",1,"virtual-container","overflow-x-hidden",3,"itemSize"],[1,"flex-auto","overflow-y-auto"],[4,"ngIf"],["class","flex flex-auto flex-col items-center justify-center h-full pt-10",4,"ngIf"],[1,"flex","flex-auto"],["class","flex flex-col flex-auto items-center justify-center bg-gray-100 dark:bg-transparent",4,"ngIf"],["class","w-full",3,"instance","chat",4,"ngIf"],["class","z-20 flex flex-auto items-center py-5 px-8 cursor-pointer border-b lg:min-w-100 lg:max-w-100 hover:bg-gray-50 dark:hover:bg-hover",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"z-20","flex","flex-auto","items-center","py-5","px-8","cursor-pointer","border-b","lg:min-w-100","lg:max-w-100","hover:bg-gray-50","dark:hover:bg-hover",3,"ngClass","click"],[1,"relative","flex","flex-0","items-center","justify-center","w-10","h-10"],[2,"background-image","url('/assets/icons/noprofil.svg')","background-repeat","no-repeat","background-size","cover","background-position","center","min-width","48px","min-height","48px"],["class","w-full h-full rounded-full",3,"src","error",4,"ngIf"],[1,"min-w-0","ml-4","relative","lg:min-w-64","lg:max-w-64"],["madBadgeSize","small","class","absolute right-0 bottom-3",3,"matBadge",4,"ngIf"],[1,"text-sm","leading-5","text-secondary","absolute","-right-3","top-0"],[1,"font-medium","leading-5","truncate","relative","w-full"],[1,"leading-5","truncate","text-secondary","text-sm","mt-1","line-clamp-1","max-w-60",3,"ngClass"],[1,"flex","flex-row"],["class","flex mr-1",3,"ngClass",4,"ngIf"],[1,"flex","flex-auto","line-clamp-1"],[3,"innerHTML",4,"ngIf"],[1,"absolute","bottom-0","right-0","flex-0","w-2","h-2","-ml-0.5","rounded-full","ring-2","dark:ring-gray-900","bg-primary","dark:bg-primary-500","text-on-primary","ring-primary-50"],[1,"w-full","h-full","rounded-full",3,"src","error"],["madBadgeSize","small",1,"absolute","right-0","bottom-3",3,"matBadge"],[1,"flex","mr-1",3,"ngClass"],["svgIcon","doublecheck",1,"icon-size-4"],[3,"innerHTML"],[1,"flex"],["svgIcon","mat_solid:camera_alt",1,"icon-size-4","mr-1"],[1,"flex","flex-auto","flex-col","items-center","justify-center","h-full","pt-10"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"],[1,"flex","flex-col","flex-auto","items-center","justify-center","bg-gray-100","dark:bg-transparent"],[1,"w-full",3,"instance","chat"]],template:function(t,e){1&t&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r.TgZ(5,"div",5),r.TgZ(6,"div",6),r.TgZ(7,"div",7),r.TgZ(8,"div",8),r.TgZ(9,"div",9),r.TgZ(10,"div",10),r.TgZ(11,"div",11),r.TgZ(12,"div",12),r._uU(13),r.ALo(14,"uppercase"),r.qZA(),r.qZA(),r.TgZ(15,"div",13),r.TgZ(16,"div"),r._uU(17),r.qZA(),r.TgZ(18,"div",14),r._uU(19),r.qZA(),r.qZA(),r.qZA(),r.TgZ(20,"button",15),r._UZ(21,"mat-icon",16),r.qZA(),r.qZA(),r.qZA(),r.TgZ(22,"cdk-virtual-scroll-viewport",17),r.TgZ(23,"div",18),r.YNc(24,I,2,1,"ng-container",19),r.YNc(25,k,4,1,"div",20),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(26,"div",21),r.YNc(27,C,4,1,"div",22),r.YNc(28,Y,1,2,"wa-conversation",23),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(13),r.hij(" ",r.lcZ(14,9,null==e.instance||null==e.instance.info?null:e.instance.info.pushname.charAt(0))," "),r.xp6(4),r.hij(" ",null==e.instance||null==e.instance.info?null:e.instance.info.pushname," "),r.xp6(2),r.hij(" ",null==e.instance||null==e.instance.info||null==e.instance.info.me?null:e.instance.info.me.user," "),r.xp6(2),r.Q6J("svgIcon","heroicons_outline:plus-circle"),r.xp6(1),r.Q6J("itemSize",0),r.xp6(2),r.Q6J("ngIf",(null==e.List?null:e.List.length)>0),r.xp6(1),r.Q6J("ngIf",(null==e.List?null:e.List.length)<=0),r.xp6(2),r.Q6J("ngIf",!e.chat||!e.chat.id),r.xp6(1),r.Q6J("ngIf",e.chat&&e.chat.id))},directives:[u.lW,d.Hw,h.N7,h.xd,f.O5,f.sg,f.mk,g.oO,m.k,p.s],pipes:[f.gd],encapsulation:2}),t})()},23402:(t,e,i)=>{"use strict";i.d(e,{s:()=>_});var n=i(16304),s=i(23815),a=i.n(s),l=i(16738),o=i.n(l),r=i(37716),c=i(42448),u=i(38583),d=i(51095),h=i(76627),f=i(98295),g=i(83166),m=i(88030);function p(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"img",23),r.NdJ("error",function(){return r.CHM(t),r.oxw().chat.profilpic=null}),r.qZA()}if(2&t){const t=r.oxw();r.Q6J("src",null==t.chat?null:t.chat.profilpic,r.LSH)}}function x(t,e){1&t&&r.GkF(0)}const v=function(t,e){return{"text-gray-100 -right-0.5 -mr-px mb-px":t,"text-white -left-0.5 -ml-px mb-px -scale-x-1":e}};function b(t,e){if(1&t&&(r.ynx(0),r.TgZ(1,"div",29),r.YNc(2,x,1,0,"ng-container",30),r.qZA(),r.BQk()),2&t){const t=r.oxw().$implicit;r.oxw();const e=r.MAs(26);r.xp6(1),r.Q6J("ngClass",r.WLB(2,v,t.fromMe,!t.fromMe)),r.xp6(1),r.Q6J("ngTemplateOutlet",e)}}function Z(t,e){if(1&t&&r._UZ(0,"div",31),2&t){const t=r.oxw().$implicit,e=r.oxw();r.Q6J("innerHTML",e.toHtml(t.body),r.oJD)}}const w=function(t,e,i,n){return{"items-end":t,"items-start":e,"mt-0.5":i,"mt-3":n}},y=function(t,e){return{"bg-gray-100":t,"bg-white":e}},A=function(t,e){return{"ml-3":t,"ml-3":e}};function S(t,e){if(1&t&&(r.ynx(0),r.TgZ(1,"div",24),r.TgZ(2,"div",25),r.YNc(3,b,3,5,"ng-container",26),r.YNc(4,Z,1,1,"div",27),r.ynx(5),r.TgZ(6,"div",28),r._uU(7),r.qZA(),r.BQk(),r.qZA(),r.qZA(),r.BQk()),2&t){const t=e.$implicit,i=e.index,n=r.oxw();r.xp6(1),r.Q6J("ngClass",r.l5B(9,w,t.fromMe,!t.fromMe,i>0&&n.List[i-1]&&n.List[i-1].fromMe===t.fromMe,i>0&&n.List[i-1]&&n.List[i-1].fromMe!==t.fromMe)),r.xp6(1),r.Gre("relative max-w-3/4 px-3 py-2 rounded-lg shadow msg-container-",i,""),r.Q6J("ngClass",r.WLB(14,y,t.fromMe,!t.fromMe)),r.xp6(1),r.Q6J("ngIf",n.List[i+1]&&n.List[i+1].fromMe!==t.fromMe),r.xp6(1),r.Q6J("ngIf",t.body),r.xp6(2),r.Q6J("ngClass",r.WLB(17,A,t.fromMe,!t.fromMe)),r.xp6(1),r.hij(" ",n.formatDate(t.timestamp)," ")}}function T(t,e){1&t&&(r.O4$(),r.TgZ(0,"svg",32),r.TgZ(1,"g",33),r._UZ(2,"path",34),r.qZA(),r.qZA())}let _=(()=>{class t{constructor(t){this.core=t,this.AllSub={},this.Busy=!0,this.List=[]}ngOnInit(){this.chat&&Object.keys(this.chat).length>0&&(this.Name="chat-"+this.instance.id+"-"+this.chat.id._serialized),setTimeout(()=>{this.loadData(),this.getDetailChat(),setTimeout(()=>{this.getDetail()},100)},100)}ngOnDestroy(){if(Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&this.AllSub[t].unsubscribe()}loadData(){var t;(null===(t=this.instance)||void 0===t?void 0:t.insid)&&this.core.getStorage({id:this.Name,isjson:!0}).then(t=>{t?(this.List=this.core.isJSON(t)?t:[],console.log(this.List),this.Busy=!1,setTimeout(()=>{$(".conversation-container").animate({scrollTop:$(".conversation-container").height()+1e4},10);var t=this.List[this.List.length-1];this.LastMessage==t.timestamp||t.fromMe||(this.LastMessage=t.timestamp)},100)):this.Busy=!1,this.AllSub["chat-"+this.chat.id._serialized]||this.initWatch(),this.clientscript()})}clientscript(){const t=$(".chat-container").width();console.log(t),$(".chat-container").animate({scrollTop:$(".chat-container").height()+1e4},10)}initWatch(){var t=this;this.AllSub["chat-"+this.chat.id._serialized]||(this.AllSub["chat-"+this.chat.id._serialized]=this.core.FS.collection(this.instance.insid+"-chats",t=>t.where("id._serialized","==",this.chat.id._serialized)).doc(this.chat.id._serialized).snapshotChanges().subscribe(function(){var e=(0,n.Z)(function*(e){const i=e.payload.data();console.log(i),i&&(t.core.isJSON(i.chats)?(t.List=i.chats,t.setChat(t.List)):t.List=[],t.Busy=!1,setTimeout(()=>{$(".conversation-container").animate({scrollTop:$(".conversation-container").height()+1e4},10)},100))});return function(t){return e.apply(this,arguments)}}()))}getDetail(){var t=this;return(0,n.Z)(function*(){let e={phone:t.instance.insid,cmd:"getdetail",user:[t.chat.id._serialized],time:null},i=yield t.core.FS.collection(t.instance.insid+"-command",t=>t.limit(1)).doc(t.instance.insid);yield i.set(e)})()}getDetailChat(){var t=this;return(0,n.Z)(function*(){t.AllSub["chat-detail-"+t.chat.id._serialized]||(t.AllSub["chat-detail-"+t.chat.id._serialized]=yield t.core.FS.collection(t.instance.insid+"-chats",t=>t.limit(1)).doc(t.chat.id._serialized).snapshotChanges().subscribe(function(){var e=(0,n.Z)(function*(e){const i=e.payload.data();i&&t.core.getStorage({id:"chat-list-"+t.instance.insid,isjson:!0}).then(e=>{if(e){let n=e;n=a().filter(n,t=>t.id._serialized!=i.id._serialized);let s=JSON.parse(JSON.stringify(i));s.last_chat=s.chats[s.chats.length-1],s.chats&&delete s.chats,n.push(s),n=a().orderBy(n,["timestamp"],["desc"]),t.core.setStorage({id:"chat-list-"+t.instance.insid,isjson:!0},n)}}).catch(t=>{console.log("Error Get Detail",t)}),t.AllSub["chat-detail-"+t.chat.id._serialized].unsubscribe()});return function(t){return e.apply(this,arguments)}}()))})()}setChat(t,e=null){this.core.setStorage({id:this.Name,isjson:!0},t).then(()=>{e&&e()})}showName(t){return t.name?t.name:t.pushname?t.pushname:t.number}showTime(t){let e,i=o()(o().unix(t)).format("YYYYMMDD"),n=o()(o()(new Date)).format("YYYYMMDD"),s=o()(o()(new Date)).subtract(1,"days").format("YYYYMMDD");return e=i!=n?i==s?this.core.translatePipe("yesterday"):o().unix(t).format("M/D/YY"):o().unix(t).format("HH:mm"),e}toHtml(t){if(t)return t=t.replace(/(?:\\[rn])+/g," "),this.core.text2html(t)}showImage(t){var e,i,n;if(null===(e=null==t?void 0:t.mediaBase)||void 0===e?void 0:e.data)return"data:"+(null===(i=null==t?void 0:t.mediaBase)||void 0===i?void 0:i.mimeType)+";base64,"+(null===(n=null==t?void 0:t.mediaBase)||void 0===n?void 0:n.data)}formatDate(t){let e;return e=o()(o().unix(t)).format("YYYYMMDD")!=o()(o()(new Date)).format("YYYYMMDD")?o().unix(t).format("YYYY-MM-DD HH:mm"):o().unix(t).format("HH:mm"),e}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(c.Q))},t.\u0275cmp=r.Xpm({type:t,selectors:[["wa-conversation"]],inputs:{chat:"chat",instance:"instance"},decls:27,vars:7,consts:[[1,"flex","flex-col","flex-auto","overflow-y-auto","lg:overflow-hidden","bg-card","dark:bg-default","h-full"],[1,"flex-auto","h-full"],[1,"flex","flex-col","flex-auto","overflow-hidden","h-full"],[1,"flex","flex-0","items-center","h-18","px-4","md:px-6","border-b","bg-gray-50","dark:bg-transparent","border-lx","shadow-lg"],[1,"flex","items-center","ml-2","lg:ml-0","mr-2","cursor-pointer"],[1,"relative","flex","flex-0","items-center","justify-center","w-10","h-10"],[2,"background-image","url('/assets/icons/noprofil.svg')","background-repeat","no-repeat","background-size","cover","background-position","center","min-width","48px","min-height","48px"],["class","w-full h-full rounded-full",3,"src","error",4,"ngIf"],[1,"ml-4","text-lg","font-medium","leading-5","truncate"],[1,"flex","overflow-y-auto","flex-col-reverse","h-full"],[1,"chat-container","flex","flex-col","overflow-y-auto","flex-shrink","p-6","bg-card","dark:bg-transparent","h-full"],[4,"ngFor","ngForOf"],[1,"flex","items-end","p-4","border-t","bg-gray-50","dark:bg-transparent"],[1,"flex","items-center","h-11","my-px"],["mat-icon-button",""],[3,"svgIcon"],["mat-icon-button","",1,"ml-0.5"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","fuse-mat-bold","w-full","ml-4"],["matInput","",1,"min-h-5","my-0","resize-none",2,"margin","11px 0 !important","padding","0 !important",3,"rows"],["messageInput",""],[1,"flex","items-center","h-11","my-px","ml-4"],[1,"transform","rotate-90",3,"svgIcon"],["speechBubbleExtension",""],[1,"w-full","h-full","rounded-full",3,"src","error"],[1,"flex","flex-col",3,"ngClass"],[2,"word-break","break-all",3,"ngClass"],[4,"ngIf"],["class","min-w-4 leading-5",3,"innerHTML",4,"ngIf"],[1,"mt-1","text-xs","text-gray-400","text-right",3,"ngClass"],[1,"absolute","bottom-0","w-3","transform",3,"ngClass"],[4,"ngTemplateOutlet"],[1,"min-w-4","leading-5",3,"innerHTML"],["width","100%","height","100%","viewBox","0 0 66 66","xmlns","http://www.w3.org/2000/svg"],["id","Page-1","stroke","none","stroke-width","1","fill","none","fill-rule","evenodd"],["d","M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z","fill","currentColor","fill-rule","nonzero"]],template:function(t,e){1&t&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r.TgZ(5,"div",5),r.TgZ(6,"div",6),r.YNc(7,p,1,1,"img",7),r.qZA(),r.qZA(),r.TgZ(8,"div",8),r._uU(9),r.qZA(),r.qZA(),r.qZA(),r.TgZ(10,"div",9),r.TgZ(11,"div",10),r.YNc(12,S,8,20,"ng-container",11),r.qZA(),r.qZA(),r.TgZ(13,"div",12),r.TgZ(14,"div",13),r.TgZ(15,"button",14),r._UZ(16,"mat-icon",15),r.qZA(),r.TgZ(17,"button",16),r._UZ(18,"mat-icon",15),r.qZA(),r.qZA(),r.TgZ(19,"mat-form-field",17),r._UZ(20,"textarea",18,19),r.qZA(),r.TgZ(22,"div",20),r.TgZ(23,"button",14),r._UZ(24,"mat-icon",21),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.YNc(25,T,3,0,"ng-template",null,22,r.W1O)),2&t&&(r.xp6(7),r.Q6J("ngIf",null==e.chat?null:e.chat.profilpic),r.xp6(2),r.hij(" ",e.showName(e.chat)," "),r.xp6(3),r.Q6J("ngForOf",e.List),r.xp6(4),r.Q6J("svgIcon","heroicons_outline:emoji-happy"),r.xp6(2),r.Q6J("svgIcon","heroicons_outline:paper-clip"),r.xp6(2),r.Q6J("rows",1),r.xp6(4),r.Q6J("svgIcon","heroicons_outline:paper-airplane"))},directives:[u.O5,u.sg,d.lW,h.Hw,f.KE,g.Nt,u.mk,m.oO,u.tP],styles:["wa-conversation .chat-container{background:#efe7dd url(/assets/4e765036-1639-11e6-9201-67e728e86f39.jpg) repeat}wa-conversation .bg-green-wa{background-color:#dcf8c6}wa-conversation .text-green-wa{color:#dcf8c6}"],encapsulation:2}),t})()},42795:(t,e,i)=>{"use strict";i.d(e,{l:()=>Z});var n=i(16304),s=i(23815),a=i.n(s),l=i(16738),o=i.n(l),r=i(37716),c=i(42448),u=i(39895),d=i(51095),h=i(76627),f=i(38583),g=i(88030),m=i(29790);function p(t,e){if(1&t&&(r.ynx(0),r.TgZ(1,"div",15),r._uU(2),r.qZA(),r.TgZ(3,"div"),r._uU(4),r.qZA(),r.BQk()),2&t){const t=r.oxw().$implicit;r.xp6(2),r.hij(" ",null==t.info?null:t.info.pushname," "),r.xp6(2),r.hij(" ",null==t.info||null==t.info.me?null:t.info.me.user," ")}}function x(t,e){1&t&&(r.ynx(0),r.TgZ(1,"div",16),r._UZ(2,"mat-icon",17),r.TgZ(3,"div"),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.qZA(),r.BQk()),2&t&&(r.xp6(4),r.hij(" ",r.lcZ(5,1,"wmu.info.notrun")," "))}function v(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"a",10),r.NdJ("click",function(){const e=r.CHM(t).$implicit,i=r.oxw(2);return i.Selected.id!=e.id?i.openInstance(e):null}),r.TgZ(2,"div",11),r.TgZ(3,"div",12),r._uU(4),r.qZA(),r.YNc(5,p,5,2,"ng-container",8),r.YNc(6,x,6,3,"ng-container",8),r.qZA(),r.TgZ(7,"div",13),r._UZ(8,"mat-icon",14),r.qZA(),r.qZA(),r.BQk()}if(2&t){const t=e.$implicit,i=r.oxw(2);r.xp6(1),r.Q6J("ngClass",t.id==i.Selected.id?"bg-hover":""),r.xp6(3),r.hij(" ",t.alias?t.alias:t.insid," "),r.xp6(1),r.Q6J("ngIf",null==t.info?null:t.info.me),r.xp6(1),r.Q6J("ngIf",1!=t.running),r.xp6(2),r.Q6J("ngClass",1==t.running?t.id==i.Selected.id?"text-blue-600":"text-green-500":"text-gray-400")("svgIcon",t.id==i.Selected.id?"mat_outline:check_circle_outline":"wa")}}function b(t,e){if(1&t&&(r.ynx(0),r.YNc(1,v,9,6,"ng-container",9),r.BQk()),2&t){const t=r.oxw();r.xp6(1),r.Q6J("ngForOf",t.Preq.instance)}}let Z=(()=>{class t{constructor(t,e){this.core=t,this.router=e,this.AllSub={},this.Ready=!1,this.Any={},this.Busy=!1,this.DataExpired=3600,this.Name={broadcast:"broadcast-list",target:"target-list",instance:"inst-list"},this.Preq={},this.Com={url:{def:"e/broadcast/",target:"e/target/",instance:"e/instance/"}},this.Selected={}}ngOnInit(){this.loadInstance(()=>{this.core.sharing("SharedData",{preq:this.Preq})})}ngOnDestroy(){if(this.core.stopAktif(),Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&this.AllSub[t].unsubscribe()}sideHide(){this.core.sharing("SideHide",2)}SelectInstance(t){this.core.setLS("SelectedInstance",t),this.initializeWA(t)}openInstance(t){1==t.running?this.core.OpenConfirm({title:this.core.translatePipe("wmu.alert.open.title"),html:this.core.translatePipe("wmu.alert.open.msg"),confirmText:this.core.translatePipe("wmu.alert.open.ok"),cancelText:this.core.translatePipe("wmu.alert.open.cancel")},e=>{e.value&&this.SelectInstance(t)}):this.core.OpenAlert({title:this.core.translatePipe("wmu.alert.notrun.title"),msg:this.core.translatePipe("wmu.alert.notrun.msg")})}loadInstance(t){this.core.getStorage({id:this.Name.instance,isjson:!0}).then(e=>{if(e)if(e.data){var i=[];for(let t of e.data)if("demo"!=t.insid){if(t.info)try{t.info=JSON.parse(t.info)}catch(n){}i.push(t)}this.Preq.instance=i,t&&t()}else this.execLoadInstance(t);else this.execLoadInstance(t)})}execLoadInstance(t){if(this.Busy)return!1;this.Busy=!0,this.core.Do(this.Com.url.instance+"data",{}).subscribe(e=>{if(e&&e.data){var i={data:e.data,stamp:o()(new Date)};this.core.setStorage({id:this.Name.instance,isjson:!0},i).then(()=>{var i=[];for(let t of e.data)e.data.length>1&&"demo"==t.insid||(t.info&&(t.info=JSON.parse(t.info)),i.push(t));this.Preq.instance=i,this.Busy=!1,t&&t()})}else this.Busy=!1,t&&t()},e=>{this.Busy=!1,t&&t()})}initializeWA(t){var e=this;return(0,n.Z)(function*(){let i=["pro","exe"],s=!1;for(let e of i)if(e==t.subsid_name){s=!0;break}if(!s)return void e.core.OpenAlert({header:e.core.translatePipe("wmu.alert.invalid_pkg.header"),msg:e.core.translatePipe("wmu.alert.invalid_pkg.msg")});e.core.ShowLoader();const l=yield e.core.FS.collection(t.insid+"-general").doc("downloadchat");yield l.get().subscribe(function(){var i=(0,n.Z)(function*(i){let s=!1;if(i.data()&&i.data().data){let t=i.data(),e=o().unix(t.data);o()(new Date).diff(e,"hours")>=24&&(s=!0)}else yield l.set({data:o()().unix()}),s=!0;const r=yield e.core.FS.collection(t.insid+"-chat-list",t=>t.limit(10));e.AllSub.getChatList=yield r.get().subscribe(function(){var i=(0,n.Z)(function*(i){let l=i.docs.map(t=>t.data());if(l.length>0&&!s)return l=a().orderBy(l,["timestamp",["desc"]]),void e.core.getStorage({id:"chat-list-"+t.insid,isjson:!0}).then(function(){var i=(0,n.Z)(function*(i){if(i&&i.length>0)if(i.length>l.length&&l.length<10)e.setChat(t,l,()=>{e.activateWA(t)});else{let n=[];for(let t of l)t.timestamp&&(n.push(t),i=a().filter(i,e=>e.id._serialized!=t.id._serialized));i=[...n,...i],i=a().orderBy(i,["timestamp"],["desc"]),e.setChat(t,i,()=>{e.activateWA(t)})}else yield e.core.FS.collection(t.insid+"-chat-list",t=>t.limit(100).orderBy("timestamp","desc")).get().subscribe(function(){var i=(0,n.Z)(function*(i){l=i.docs.map(t=>t.data()),l=a().orderBy(l,["timestamp"],["desc"]),console.log("current",l),e.setChat(t,l,()=>{e.activateWA(t)})});return function(t){return i.apply(this,arguments)}}())});return function(t){return i.apply(this,arguments)}}());var o={phone:t.info.me._serialized,cmd:"initlist",time:null};e.Command=yield e.core.FS.collection(t.insid+"-command",e=>e.where("phone","==",t.info.me._serialized).limit(1)).doc(t.info.me._serialized),yield e.Command.set(o),e.AllSub.getChatListNew=yield e.core.FS.collection(t.insid+"-chat-list",t=>t.limit(100).orderBy("timestamp","desc")).snapshotChanges().subscribe(i=>{if(i.length>0){let n=i.map(t=>t.payload.doc.data());n=a().orderBy(n,["timestamp"],["desc"]),e.core.sharingTemp="loadNewList",e.setChat(t,n,()=>{e.activateWA(t)})}})});return function(t){return i.apply(this,arguments)}}())});return function(t){return i.apply(this,arguments)}}())})()}activateWA(t){if(this.core.stopAktif(),this.sideHide(),this.Selected=t,this.core.sharing("SelectInstance",t),Object.keys(this.AllSub).length>0)for(let e in this.AllSub)this.AllSub[e]&&this.AllSub[e].unsubscribe();this.router.navigate(["/multiuser/"+t.insid]),this.core.HideLoader()}setChat(t,e,i){this.core.setStorage({id:"chat-list-"+t.insid,isjson:!0},e).then(()=>{i()})}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(c.Q),r.Y36(u.F0))},t.\u0275cmp=r.Xpm({type:t,selectors:[["wa-instance-list"]],decls:11,vars:1,consts:[[1,"relative","flex","flex-auto","w-full","bg-card","dark:bg-transparent","h-full"],[1,"relative","flex","flex-auto","flex-col","w-full","min-w-0","lg:min-w-80","lg:max-w-80","border-r","z-10"],[1,"relative","flex","flex-0","items-center","justify-between","h-16","px-4","border-b","bg-gray-200","text-gray-700","dark:bg-transparent"],[1,"flex","items-center"],[1,"ml-2","font-semibold","uppercase"],["mat-icon-button","",3,"click"],["svgIcon","heroicons_outline:chevron-left",1,"icon-size-5"],[1,"overflow-y-auto"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"relative","flex","flex-row","border-t","first:border-0","hover:bg-hover","cursor-pointer","p-5","px-6",3,"ngClass","click"],[1,"flex","flex-col","flex-auto"],[1,"text-xs"],[1,"flex"],[1,"icon-size-12","my-auto",3,"ngClass","svgIcon"],[1,"font-semibold","mt-2"],[1,"flex","flex-row","mt-2","italic","text-sm","text-red-700"],["svgIcon","heroicons_outline:information-circle",1,"icon-size-5","mr-2","text-red-700"]],template:function(t,e){1&t&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r._uU(5," Instance List "),r.qZA(),r.qZA(),r.TgZ(6,"div",3),r.TgZ(7,"a",5),r.NdJ("click",function(){return e.sideHide()}),r._UZ(8,"mat-icon",6),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"div",7),r.YNc(10,b,2,1,"ng-container",8),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(10),r.Q6J("ngIf",(null==e.Preq||null==e.Preq.instance?null:e.Preq.instance.length)>0))},directives:[d.zs,h.Hw,f.O5,f.sg,f.mk,g.oO],pipes:[m.X$],encapsulation:2}),t})()},55498:(t,e,i)=>{"use strict";i.d(e,{N:()=>a});var n=i(37716),s=i(76627);let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Xpm({type:t,selectors:[["wa-no-instance"]],decls:5,vars:1,consts:[[1,"flex","flex-col","flex-auto","overflow-y-auto","lg:overflow-hidden","bg-card","dark:bg-default","h-full"],[1,"flex","flex-col","flex-auto","items-center","justify-center","bg-gray-100","dark:bg-transparent","h-full"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n._UZ(2,"mat-icon",2),n.TgZ(3,"div",3),n._uU(4," Please Select Instance to Start Whatsapp Web Chat "),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(2),n.Q6J("svgIcon","wa"))},directives:[s.Hw],encapsulation:2}),t})()},15472:(t,e,i)=>{"use strict";i.d(e,{V:()=>r});var n=i(39895),s=i(96457),a=(i(42795),i(55498),i(37624),i(23402),i(47908)),l=i(37716);const o=[{path:"",children:[{path:"",component:s.z},{path:":insid",component:a.i}]}];let r=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[n.Bz.forChild(o)],n.Bz]}),t})()},96457:(t,e,i)=>{"use strict";i.d(e,{z:()=>h});var n=i(37716),s=i(42448),a=i(38583),l=i(88030),o=i(51095),r=i(76627),c=i(42795),u=i(55498);function d(t,e){1&t&&n._UZ(0,"wa-no-instance",9)}let h=(()=>{class t{constructor(t){this.core=t,this.AllSub={},this.SideShow=!0,this.SelectedInstance={},this.SharedData={},this.subSharing()}subSharing(){this.AllSub.SideHide=this.core.getSharing("SideHide").subscribe(t=>{t&&(this.SideShow=1==t,this.core.sharing("SideHide",null))}),this.AllSub.SelectInstance=this.core.getSharing("SelectInstance").subscribe(t=>{if(t){let e=10;t.id!=this.SelectedInstance.id&&(this.SelectedInstance={},e=1e3),setTimeout(()=>{this.SelectedInstance=t,this.core.sharing("SelectInstance",null)},e)}}),this.AllSub.SharedData=this.core.getSharing("SharedData").subscribe(t=>{t&&t.preq&&(this.SharedData.preq=t.preq)})}ngOnInit(){this.core.setTitle("Whatsapp Multiuser")}ngOnDestroy(){if(this.core.stopAktif(),Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&this.AllSub[t].unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.Q))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-wamulti-users"]],decls:9,vars:3,consts:[[1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-hidden"],[1,"flex-auto","h-fullx"],[1,"flex","flex-col","overflow-hidden","h-full"],[1,"flex","flex-auto","overflow-hidden","border","h-fullx","relative"],[1,"absolute","left-0","top-0","p-1","bg-primary",2,"z-index","2","height","72px",3,"ngClass","click"],["mat-icon-button","",1,"mt-3"],["svgIcon","heroicons_outline:chevron-right",1,"icon-size-5","text-white"],[1,"absolute","left-0","h-full",2,"z-index","1",3,"ngClass"],["class","ml-80 w-full",4,"ngIf"],[1,"ml-80","w-full"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.TgZ(4,"div",4),n.NdJ("click",function(){return e.SideShow=!0}),n.TgZ(5,"a",5),n._UZ(6,"mat-icon",6),n.qZA(),n.qZA(),n._UZ(7,"wa-instance-list",7),n.YNc(8,d,1,0,"wa-no-instance",8),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(4),n.Q6J("ngClass",e.SideShow?"invisible":"visible"),n.xp6(3),n.Q6J("ngClass",e.SideShow?"visible":"invisible"),n.xp6(1),n.Q6J("ngIf",!(null!=e.SelectedInstance&&e.SelectedInstance.id)))},directives:[a.mk,l.oO,o.zs,r.Hw,c.l,a.O5,u.N],styles:["wa-conversation[_ngcontent-%COMP%]   .chat-container[_ngcontent-%COMP%]{background:#efe7dd url(/assets/4e765036-1639-11e6-9201-67e728e86f39.jpg) repeat}wa-conversation[_ngcontent-%COMP%]   .bg-green-wa[_ngcontent-%COMP%]{background-color:#dcf8c6}wa-conversation[_ngcontent-%COMP%]   .text-green-wa[_ngcontent-%COMP%]{color:#dcf8c6}"]}),t})()},90942:(t,e,i)=>{"use strict";i.r(e),i.d(e,{WAMultiUsersModule:()=>c});var n=i(38583),s=i(15472),a=i(44466),l=i(49616),o=i(71386),r=i(37716);i(96457),i(42795),i(47908),i(37624),i(23402);let c=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[n.ez,s.V,a.m,l.m,o.Cl]]}),t})()}}]);