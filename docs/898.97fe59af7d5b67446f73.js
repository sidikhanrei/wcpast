(self.webpackChunkwachatpro_webclient=self.webpackChunkwachatpro_webclient||[]).push([[898],{93409:(t,e,a)=>{"use strict";a.d(e,{uC:()=>s});var i=a(39895),l=a(65372),o=(a(40190),a(59096),a(21953),a(37716));const n=[{path:"",children:[{path:"",component:l.M}]}];let s=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[i.Bz.forChild(n)],i.Bz]}),t})()},65372:(t,e,a)=>{"use strict";a.d(e,{M:()=>s});var i=a(37716),l=a(42448),o=a(21953),n=a(40190);let s=(()=>{class t{constructor(t){this.core=t}ngOnInit(){this.core.setTitle("Broadcast")}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.Q))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-broadcast"]],decls:6,vars:0,consts:[[1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-hidden"],[1,"flex-auto","h-full"],[1,"flex","flex-col","overflow-hidden","h-full"],[1,"flex","flex-auto","overflow-hidden","border","h-full"],[1,"h-full","w-full","border-l"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"div",2),i.TgZ(3,"div",3),i._UZ(4,"broadcast-list"),i._UZ(5,"broadcast-detail",4),i.qZA(),i.qZA(),i.qZA(),i.qZA())},directives:[o.v,n.W],styles:[""]}),t})()},99898:(t,e,a)=>{"use strict";a.r(e),a.d(e,{BroadcastModule:()=>d});var i=a(38583),l=a(93409),o=a(49616),n=a(71386),s=a(571),r=a(37716);a(65372),a(21953),a(40190),a(59096);let d=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,l.uC,o.m,n.Cl,s.sF.withComponents([])]]}),t})()},40190:(t,e,a)=>{"use strict";a.d(e,{W:()=>C});var i=a(23815),l=a.n(i),o=a(16738),n=a.n(o),s=a(37716),r=a(42448),d=a(38583),c=a(33935),f=a(1769),u=a(51095),m=a(76627),g=a(571),h=a(29790);function x(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",27),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Command("duplicate")}),s._UZ(1,"mat-icon",28),s._uU(2),s.ALo(3,"translate"),s.qZA()}2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.detail.fab.duplicate")," "))}function p(t,e){if(1&t&&(s.TgZ(0,"button",29),s._UZ(1,"mat-icon",30),s._uU(2," Menu "),s.qZA()),2&t){s.oxw();const t=s.MAs(16);s.Q6J("matMenuTriggerFor",t)}}function Z(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",31),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Command("edit")}),s._UZ(1,"mat-icon",32),s._uU(2),s.ALo(3,"translate"),s.qZA()}2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.detail.fab.edit")," "))}function b(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",31),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Command("duplicate")}),s._UZ(1,"mat-icon",28),s._uU(2),s.ALo(3,"translate"),s.qZA()}2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.detail.fab.duplicate")," "))}function _(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",33),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Command("stop")}),s._UZ(1,"mat-icon",34),s._uU(2),s.ALo(3,"translate"),s.qZA()}2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.detail.fab.stop")," "))}function v(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",33),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Command("delete")}),s._UZ(1,"mat-icon",35),s._uU(2),s.ALo(3,"translate"),s.qZA()}2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.detail.fab.delete")," "))}function A(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",36),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).Reload()}),s._UZ(1,"mat-icon",37),s._uU(2," Reload "),s.qZA()}}function w(t,e){if(1&t&&(s.TgZ(0,"div",38),s.TgZ(1,"div",39),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.TgZ(4,"div",40),s._uU(5),s.qZA(),s.qZA()),2&t){const t=s.oxw(2);s.xp6(2),s.hij(" ",s.lcZ(3,2,"broadcast.detail.status.wait")," "),s.xp6(3),s.hij(" ",t.formatDate(null==t.Detail?null:t.Detail.jadwal_time)," ")}}function T(t,e){1&t&&(s.TgZ(0,"div",38),s.TgZ(1,"div",39),s._uU(2," Status "),s.qZA(),s.TgZ(3,"div",40),s._uU(4," In Progress "),s.qZA(),s.qZA())}function y(t,e){if(1&t&&(s.TgZ(0,"div",38),s.TgZ(1,"div",39),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.TgZ(4,"div",41),s._uU(5),s.qZA(),s.qZA()),2&t){const t=s.oxw(2);s.xp6(2),s.hij(" ",s.lcZ(3,2,"broadcast.detail.finish_date")," "),s.xp6(3),s.hij(" ",t.formatDate(null==t.Detail?null:t.Detail.finish_date)," ")}}function D(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div",42),s.TgZ(1,"div",43),s.TgZ(2,"div",44),s._uU(3," Target List "),s.qZA(),s.TgZ(4,"ag-grid-angular",45),s.NdJ("gridReady",function(e){return s.CHM(t),s.oxw(2).onGridReady(e)}),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.oxw(2);s.xp6(4),s.Q6J("columnDefs",t.TableCol)("getContextMenuItems",t.getContextMenuItems)("defaultColDef",t.gridOptions.defaultColDef)("context",t.gridOptions.context)("animateRows",t.gridOptions.animateRows)("allowContextMenuWithControlKey",t.gridOptions.allowContextMenuWithControlKey)("rowModelType","infinite")("rowBuffer",0)("debug",t.gridOptions.debug)("rowSelection",t.gridOptions.rowSelection)("cacheOverflowSize",t.gridOptions.cacheOverflowSize)("maxConcurrentDatasourceRequests",2)("paginationPageSize",100)("infiniteInitialRowCount",1)("cacheBlockSize",t.gridOptions.cacheBlockSize)("maxBlocksInCache",2)("components",t.components)("tooltipShowDelay",10)}}function q(t,e){if(1&t&&(s.ynx(0),s.TgZ(1,"div",3),s.TgZ(2,"div",4),s.TgZ(3,"div",5),s.TgZ(4,"div"),s._uU(5),s.qZA(),s.TgZ(6,"div",6),s._uU(7),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(8,"div",7),s.TgZ(9,"div",8),s.TgZ(10,"div",9),s.TgZ(11,"div",10),s.TgZ(12,"div",11),s.YNc(13,x,4,3,"button",12),s.YNc(14,p,3,1,"button",13),s.TgZ(15,"mat-menu",null,14),s.YNc(17,Z,4,3,"button",15),s.YNc(18,b,4,3,"button",15),s._UZ(19,"mat-divider"),s.YNc(20,_,4,3,"button",16),s.YNc(21,v,4,3,"button",16),s.qZA(),s.qZA(),s.TgZ(22,"div"),s.YNc(23,A,3,0,"button",17),s.qZA(),s.qZA(),s.TgZ(24,"div",18),s.TgZ(25,"div",19),s.TgZ(26,"div",20),s.TgZ(27,"div",21),s.TgZ(28,"div",6),s._uU(29," Broadcast Type "),s.qZA(),s.TgZ(30,"div"),s._uU(31),s.qZA(),s.qZA(),s.TgZ(32,"div",22),s.TgZ(33,"div",6),s._uU(34),s.ALo(35,"translate"),s.qZA(),s.TgZ(36,"div"),s._uU(37),s.qZA(),s.qZA(),s.TgZ(38,"div",23),s.YNc(39,w,6,4,"div",24),s.YNc(40,T,5,0,"div",24),s.YNc(41,y,6,4,"div",24),s.qZA(),s.qZA(),s.qZA(),s._UZ(42,"div",25),s.qZA(),s.qZA(),s.YNc(43,D,5,18,"div",26),s.qZA(),s.qZA(),s.BQk()),2&t){const t=s.oxw();s.xp6(5),s.hij(" ",t.Detail.alias?t.Detail.alias:t.Detail.insid," "),s.xp6(2),s.hij(" ",t.formatDate(null==t.Detail?null:t.Detail.create_date)," "),s.xp6(6),s.Q6J("ngIf",t.Detail.finish_date),s.xp6(1),s.Q6J("ngIf",!t.Detail.finish_date),s.xp6(3),s.Q6J("ngIf",!(null!=t.Detail&&t.Detail.nextrun_date)),s.xp6(1),s.Q6J("ngIf",!t.Detail.finish_date),s.xp6(2),s.Q6J("ngIf",(null==t.Detail?null:t.Detail.nextrun_date)&&!(null!=t.Detail&&t.Detail.finish_date)),s.xp6(1),s.Q6J("ngIf",!(null!=t.Detail&&t.Detail.nextrun_date)),s.xp6(2),s.Q6J("ngIf",!t.Detail.finish_date),s.xp6(8),s.hij(" ",1==(null==t.Detail?null:t.Detail.delay)?"Smart Delay":"Manual Timer"," "),s.xp6(3),s.hij(" ",s.lcZ(35,17,"broadcast.detail.create_date")," "),s.xp6(3),s.hij(" ",t.formatDate(null==t.Detail?null:t.Detail.create_date)," "),s.xp6(2),s.Q6J("ngIf",!t.Detail.finish_date&&!t.Detail.nextrun_date&&2==t.Detail.jadwal),s.xp6(1),s.Q6J("ngIf",!t.Detail.finish_date&&t.Detail.nextrun_date),s.xp6(1),s.Q6J("ngIf",t.Detail.finish_date),s.xp6(1),s.Q6J("innerHTML",t.Content,s.oJD),s.xp6(1),s.Q6J("ngIf",t.GridReady)}}function M(t,e){1&t&&(s.TgZ(0,"div",46),s._UZ(1,"mat-icon",47),s.TgZ(2,"div",48),s._uU(3," Select broadcast to view detail "),s.qZA(),s.qZA()),2&t&&(s.xp6(1),s.Q6J("svgIcon","iconsmind:blinklist"))}let C=(()=>{class t{constructor(t){this.core=t,this.AllSub={},this.Detail={},this.List=[],this.GridReady=!1,this.Busy=!1,this.Name={broadcast:"broadcast-list"},this.gridFilter="{}",this.gridSort="[]",this.gridFiltered=!1,this.gridSorted=!1,this.TableCol=[{headerName:"Name",field:"nama",tooltipField:"nama",width:200,minWidth:200,suppressSizeToFit:!0,filterParams:{filterOptions:["contains"],suppressAndOrCondition:!1},cellRenderer:"loadingCellRenderer"},{headerName:"Number",field:"id",suppressSizeToFit:!0,width:175,minWidth:175,filterParams:{filterOptions:["contains"],suppressAndOrCondition:!1},cellRenderer:"loadingCellRenderer",valueGetter:t=>{if(t.data)return t.data.id.split("@")[0]}},{headerName:"Check",width:175,minWidth:175,filter:!1,sortable:!1,cellRenderer:"loadingCellRenderer",valueGetter:t=>{if(t.data){let e=t.data.last_check;if(e){let t=n().unix(e);return n()(t).format("YYYY-MM-DD HH:mm:ss")}return"-"}}},{headerName:"Sent",width:175,minWidth:175,filter:!1,sortable:!1,cellRenderer:"loadingCellRenderer",valueGetter:t=>{if(t.data){let e=t.data.sent;if(e){let t=n().unix(e);return n()(t).format("YYYY-MM-DD HH:mm:ss")}return"-"}}},{headerName:"Online",width:100,minWidth:100,filter:!1,sortable:!1,cellRenderer:"loadingCellRenderer",valueGetter:t=>{if(t.data)return t.data.online?"Yes":"-"}}],this.AllSub.Detail=this.core.getSharing("Detail").subscribe(t=>{this.GridReady=!1,t&&t.id!=this.Detail.id?(this.Detail=t,this.formatData()):this.Detail={}}),this.components={loadingCellRenderer:function(t){return void 0!==t.value?t.value:'\n                    <svg \n                        class="animate-spin text-primary h-6 w-6 mt-2"\n                        xmlns="http://www.w3.org/2000/svg" \n                        fill="none" \n                        viewBox="0 0 24 24"\n                    >\n                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                    </svg>\n                    '}}}ngOnInit(){}Reload(){this.GridReady=!1,this.Detail.target_data&&(this.Detail.target_data=JSON.parse(this.Detail.target_data)),this.formatData()}ngAfterViewInit(){this.gridOptions=this.core.getGridOptions(),this.gridOptions.context={parent:this}}ngOnDestroy(){if(Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&this.AllSub[t].unsubscribe()}formatDate(t){return t?n()(t).format("YYYY-MM-DD HH:mm"):"-"}formatData(){if(!this.Detail)return;let t;this.Target&&(t=l().find(this.Target,{id:Number(this.Detail.target_id)})),t&&(this.Detail.target_nama=t.nama),this.Detail.target_data&&(this.List=l().orderBy(this.Detail.target_data,["sent"],["asc"]),setTimeout(()=>{this.GridReady=!0},500)),this.ExtractList()}ExtractList(){var t;this.Detail&&(null===(t=this.Detail)||void 0===t?void 0:t.target_data)&&(this.Detail.content&&(this.Content=JSON.parse(JSON.stringify(this.core.text2html(this.Detail.content)))),this.Detail.finish_date||this.getNewDetail())}getNewDetail(){if(!this.Busy){var t={id:this.Detail.id};this.Busy=!0,this.core.Do("e/broadcast/detail",t).subscribe(t=>{t&&1==t.status&&t.data?(this.Detail=t.data,this.core.getStorage({id:this.Name.broadcast,isjson:!0}).then(e=>{if(this.Busy=!1,e){let a=[...l().filter(e.data,t=>t.id!=this.Detail.id),t.data];a=l().uniqBy(a,"id"),a=l().orderBy(a,t=>n()(t.jadwal_time,"YYYY-MM-DD HH:mm:ss")>n()(t.create_date,"YYYY-MM-DD HH:mm:ss")?n()(t.finish_date,"YYYY-MM-DD HH:mm:ss")>n()(t.jadwal_time,"YYYY-MM-DD HH:mm:ss")?t.finish_date:t.jadwal_time:t.create_date,["desc"]),this.core.setStorage({id:this.Name.broadcast,isjson:!0},{data:a,stamp:n()(new Date)}).then(()=>{setTimeout(()=>{this.core.sharing("updateDetailed",t.data)},100)})}})):this.Busy=!1},t=>{this.Busy=!1})}}gridLoadData(t){let e=this.List;t.api.setDatasource({rowCount:null,getRows:t=>{setTimeout(()=>{let a=JSON.parse(JSON.stringify(e));if(Object.keys(t.filterModel).length>0||Object.keys(t.sortModel).length>0){if(Object.keys(t.sortModel).length>0){let e=[],i=[];for(let a of t.sortModel)e.push(a.colId),i.push(a.sort);a=l().orderBy(a,e,i)}if(Object.keys(t.filterModel).length>0)for(let e in t.filterModel)a=this.core.Search(a,t.filterModel[e].filter)}let i=a,o=i.slice(t.startRow,t.endRow),n=-1;i.length<=t.endRow&&(n=i.length),t.successCallback(o,n)},100)}})}onGridReady(t){this.gridParams=t,this.gridApi=t.api,t.api.sizeColumnsToFit(),this.gridLoadData(t)}Command(t){clearTimeout(this.delayCommand),this.delayCommand=setTimeout(()=>{this.core.sharing("broadcastListCommand",{command:t,data:this.Detail})},100)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(r.Q))},t.\u0275cmp=s.Xpm({type:t,selectors:[["broadcast-detail"]],decls:3,vars:2,consts:[[1,"flex","flex-col","flex-auto","overflow-y-auto","lg:overflow-hidden","bg-card","dark:bg-default","h-full"],[4,"ngIf"],["class","flex flex-col flex-auto items-center justify-center bg-gray-100 dark:bg-transparent h-full",4,"ngIf"],[1,"z-10","relative","flex","flex-col","flex-0","w-full","border-b"],[1,"flex","flex-wrap","items-center","py-5","px-6"],[1,"flex","flex-col","flex-auto","my-1","mr-4","text-2xl"],[1,"text-sm"],[1,"flex","flex-col","flex-auto","flex-shrink-0","lg:flex-shrink","p-3","lg:overflow-y-auto","bg-gray-100","dark:bg-transparent"],[1,"flex","flex-auto","sm:flex-row","xs:flex-col"],[1,"flex","flex-col","flex-auto","shadow","rounded-2xl","bg-card","dark:bg-black","dark:bg-opacity-10","max-w-140"],[1,"flex","w-full","p-2","border-b","rounded-t-2xl","bg-gray-50","dark:bg-transparent"],[1,"flex","flex-auto"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","","class","text-red-700",3,"click",4,"ngIf"],["mat-flat-button","",3,"click",4,"ngIf"],[1,"flex","flex-col","flex-auto"],[1,"flex","flex-col","items-start","w-full","py-6","px-6"],[1,"flex","flex-auto","sm:flex-row","xs:flex-col","w-full","relative"],[1,"flex","flex-col"],[1,"flex","flex-col","sm:ml-10","sm:mt-0","xs:mt-4"],[1,"flex","flex-col","flex-auto","sm:absolute","xs:relative","sm:right-0","sm:mt-0","xs:mt-4"],["class","flex flex-auto flex-col",4,"ngIf"],[1,"flex","whitespace-pre-line","leading-relaxed","border-t","py-6","px-6",3,"innerHTML"],["class","flex flex-auto h-full md:min-w-100 sm:w-120 shadow rounded-2xl overflow-hidden bg-card dark:bg-black dark:bg-opacity-10 sm:ml-3 sm:mt-0 xs:mt-3",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],["svgIcon","heroicons_outline:duplicate",1,"mr-2","icon-size-5"],["mat-flat-button","","color","primary",3,"matMenuTriggerFor"],["svgIcon","heroicons_solid:menu",1,"mr-2","icon-size-4"],["mat-menu-item","",3,"click"],["svgIcon","heroicons_outline:pencil",1,"mr-2","icon-size-5"],["mat-menu-item","",1,"text-red-700",3,"click"],["svgIcon","mat_outline:stop_circle",1,"mr-2","icon-size-5","text-red-700"],["svgIcon","heroicons_outline:trash",1,"mr-2","icon-size-5","text-red-700"],["mat-flat-button","",3,"click"],["svgIcon","heroicons_outline:refresh",1,"mr-2","icon-size-5"],[1,"flex","flex-auto","flex-col"],[1,"mr-2","font-semibold","text-sm"],[1,"text-yellow-600"],[1,"text-blue-600"],[1,"flex","flex-auto","h-full","md:min-w-100","sm:w-120","shadow","rounded-2xl","overflow-hidden","bg-card","dark:bg-black","dark:bg-opacity-10","sm:ml-3","sm:mt-0","xs:mt-3"],[1,"flex","flex-auto","flex-col","py-8","pt-4","px-4","min-h-100"],[1,"font-bold","mb-4"],[1,"grid-class","ag-theme-alpine",3,"columnDefs","getContextMenuItems","defaultColDef","context","animateRows","allowContextMenuWithControlKey","rowModelType","rowBuffer","debug","rowSelection","cacheOverflowSize","maxConcurrentDatasourceRequests","paginationPageSize","infiniteInitialRowCount","cacheBlockSize","maxBlocksInCache","components","tooltipShowDelay","gridReady"],[1,"flex","flex-col","flex-auto","items-center","justify-center","bg-gray-100","dark:bg-transparent","h-full"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.YNc(1,q,44,19,"ng-container",1),s.YNc(2,M,4,1,"div",2),s.qZA()),2&t&&(s.xp6(1),s.Q6J("ngIf",e.Detail.id),s.xp6(1),s.Q6J("ngIf",!e.Detail.id))},directives:[d.O5,c.VK,f.d,u.lW,m.Hw,c.p6,c.OP,g.N8],pipes:[h.X$],encapsulation:2}),t})()},59096:(t,e,a)=>{"use strict";a.d(e,{M:()=>Q});var i=a(23815),l=a.n(i),o=a(16738),n=a.n(o),s=a(37716),r=a(42448),d=a(22238),c=a(77310),f=a(38583),u=a(3679),m=a(88030),g=a(98295),h=a(67441),x=a(51095),p=a(76627),Z=a(5015),b=a(83166),_=a(69129),v=a(43220),A=a(29790);function w(t,e){1&t&&(s.TgZ(0,"button",21),s._UZ(1,"mat-icon",22),s.qZA()),2&t&&(s.xp6(1),s.Q6J("svgIcon","heroicons_outline:x"))}function T(t,e){1&t&&(s.ynx(0),s.TgZ(1,"mat-option",23),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.BQk()),2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.form.no_instance")," "))}function y(t,e){if(1&t&&(s.TgZ(0,"mat-option",25),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.Tol(1!=t.expired&&t.expired_date&&1==t.running?"":"line-through"),s.Q6J("value",t.insid)("disabled",1==t.expired||!t.expired_date||1!=t.running),s.xp6(1),s.hij(" ",null!=t&&null!=t.info&&null!=t.info.me&&t.info.me.user?null==t||null==t.info||null==t.info.me?null:t.info.me.user:t.insid," ")}}function D(t,e){if(1&t&&(s.ynx(0),s.YNc(1,y,2,5,"mat-option",24),s.BQk()),2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.Preq.instance)}}function q(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"mat-form-field",9),s.TgZ(1,"mat-label"),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.TgZ(4,"mat-select",26),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().form.jadwal=e})("ngModelChange",function(){s.CHM(t);const e=s.oxw();return 2==e.form.jadwal?e.genTime():null}),s.ALo(5,"translate"),s.TgZ(6,"mat-option",27),s._uU(7),s.ALo(8,"translate"),s.qZA(),s.TgZ(9,"mat-option",27),s._uU(10),s.ALo(11,"translate"),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.oxw();s.xp6(2),s.hij(" ",s.lcZ(3,7,"broadcast.form.schedule.label")," "),s.xp6(2),s.Q6J("placeholder",s.lcZ(5,9,"broadcast.form.schedule.label"))("ngModel",t.form.jadwal),s.xp6(2),s.Q6J("value",1),s.xp6(1),s.hij(" ",s.lcZ(8,11,"broadcast.form.schedule.v1")," "),s.xp6(2),s.Q6J("value",2),s.xp6(1),s.hij(" ",s.lcZ(11,13,"broadcast.form.schedule.v2")," ")}}function M(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",49),s.NdJ("click",function(){s.CHM(t),s.oxw();const e=s.MAs(11);return s.oxw(2).State.is_detail?null:e.open()}),s._UZ(1,"mat-icon",50),s.qZA()}if(2&t){s.oxw();const t=s.MAs(11);s.xp6(1),s.Q6J("matDatepicker",t)}}function C(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div",40),s.TgZ(1,"div",41),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.TgZ(4,"mat-form-field",42),s.TgZ(5,"mat-label"),s._uU(6,"Date Schedule"),s.qZA(),s.TgZ(7,"input",43),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(2).form.schedule_date=e})("click",function(){s.CHM(t);const e=s.MAs(11),a=s.oxw(2);return a.State.is_detail||a.form.schedule_date?null:e.open()}),s.qZA(),s.TgZ(8,"input",44),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(2).form.select_schedule_date=e})("ngModelChange",function(){return s.CHM(t),s.oxw(2).setDate("schedule_date")}),s.qZA(),s.YNc(9,M,2,1,"button",45),s._UZ(10,"mat-datepicker",null,46),s.qZA(),s.TgZ(12,"mat-form-field",47),s.TgZ(13,"mat-label"),s._uU(14," Time "),s.qZA(),s.TgZ(15,"input",48),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(2).form.schedule_time=e}),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=s.MAs(11),e=s.oxw(2);s.xp6(2),s.hij(" ",s.lcZ(3,10,"broadcast.form.schedule.set")," "),s.xp6(5),s.Q6J("ngModel",e.form.schedule_date)("readonly",e.State.is_detail)("leadZeroDateTime",!0),s.xp6(1),s.Q6J("matDatepicker",t)("ngModel",e.form.select_schedule_date)("min",e.Now),s.xp6(1),s.Q6J("ngIf",!e.State.is_detail),s.xp6(6),s.Q6J("ngModel",e.form.schedule_time)("readonly",e.State.is_detail)}}function N(t,e){1&t&&(s.TgZ(0,"mat-hint",51),s._UZ(1,"mat-icon",52),s.TgZ(2,"div",53),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.qZA()),2&t&&(s.xp6(3),s.hij(" ",s.lcZ(4,1,"broadcast.form.schedule.delayInfo")," "))}function S(t,e){if(1&t){const t=s.EpF();s.ynx(0),s.YNc(1,C,16,12,"div",28),s.TgZ(2,"mat-form-field",29),s.TgZ(3,"mat-label"),s._uU(4),s.ALo(5,"translate"),s.qZA(),s.TgZ(6,"mat-select",30),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().form.delay=e}),s._UZ(7,"mat-option",31),s.ALo(8,"translate"),s.TgZ(9,"mat-option",27),s._uU(10),s.ALo(11,"translate"),s.qZA(),s.qZA(),s.YNc(12,N,5,3,"mat-hint",32),s.qZA(),s.TgZ(13,"div",33),s.TgZ(14,"mat-form-field",34),s.TgZ(15,"mat-label"),s._uU(16),s.ALo(17,"translate"),s.qZA(),s.TgZ(18,"input",35),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().form.delay_message=e}),s.ALo(19,"translate"),s.qZA(),s.TgZ(20,"span",36),s._uU(21),s.ALo(22,"translate"),s.qZA(),s.qZA(),s.TgZ(23,"mat-form-field",34),s.TgZ(24,"mat-label"),s._uU(25),s.ALo(26,"translate"),s.qZA(),s.TgZ(27,"input",37),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().form.rest_every=e}),s.qZA(),s.TgZ(28,"span",36),s._uU(29),s.ALo(30,"translate"),s.qZA(),s.qZA(),s.TgZ(31,"mat-form-field",38),s.TgZ(32,"mat-label"),s._uU(33),s.ALo(34,"translate"),s.qZA(),s.TgZ(35,"input",39),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw().form.rest_for=e}),s.qZA(),s.TgZ(36,"span",36),s._uU(37),s.ALo(38,"translate"),s.qZA(),s.qZA(),s.qZA(),s.BQk()}if(2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngIf",2==t.form.jadwal),s.xp6(1),s.Q6J("ngClass",1==t.form.delay?"mb-6":""),s.xp6(2),s.hij(" ",s.lcZ(5,22,"broadcast.form.schedule.delay")," "),s.xp6(2),s.Q6J("ngModel",t.form.delay),s.xp6(1),s.Q6J("value",1)("innerHTML",s.lcZ(8,24,"broadcast.form.schedule.delay1"),s.oJD),s.xp6(2),s.Q6J("value",2),s.xp6(1),s.hij(" ",s.lcZ(11,26,"broadcast.form.schedule.delay2")," "),s.xp6(2),s.Q6J("ngIf",1==t.form.delay),s.xp6(4),s.hij(" ",s.lcZ(17,28,"broadcast.form.delay.t1")," "),s.xp6(2),s.Q6J("ngModel",t.form.delay_message)("readonly",t.State.is_detail)("placeholder",s.lcZ(19,30,"broadcast.form.delay.t1_info")),s.xp6(3),s.hij(" ",s.lcZ(22,32,"broadcast.form.delay.t1_suffix")," "),s.xp6(4),s.hij(" ",s.lcZ(26,34,"broadcast.form.delay.t2")," "),s.xp6(2),s.Q6J("ngModel",t.form.rest_every)("readonly",t.State.is_detail),s.xp6(2),s.hij(" ",s.lcZ(30,36,"broadcast.form.delay.t2_suffix")," "),s.xp6(4),s.hij(" ",s.lcZ(34,38,"broadcast.form.delay.t3")," "),s.xp6(2),s.Q6J("ngModel",t.form.rest_for)("readonly",t.State.is_detail),s.xp6(2),s.hij(" ",s.lcZ(38,40,"broadcast.form.delay.t3_suffix")," ")}}function J(t,e){1&t&&(s.ynx(0),s.TgZ(1,"mat-option",23),s._uU(2),s.ALo(3,"translate"),s.qZA(),s.BQk()),2&t&&(s.xp6(2),s.hij(" ",s.lcZ(3,1,"broadcast.form.target.noTarget")," "))}function Y(t,e){if(1&t&&(s.TgZ(0,"mat-option",27),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.Q6J("value",t.id),s.xp6(1),s.AsE(" ",t.nama," (",t.data.length,") ")}}function L(t,e){if(1&t&&(s.ynx(0),s.YNc(1,Y,2,3,"mat-option",58),s.BQk()),2&t){const t=s.oxw(3);s.xp6(1),s.Q6J("ngForOf",t.Preq.target)}}function I(t,e){if(1&t){const t=s.EpF();s.ynx(0),s.TgZ(1,"mat-form-field",9),s.TgZ(2,"mat-label"),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.TgZ(5,"mat-select",55),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(2).form.target=e}),s.ALo(6,"translate"),s.YNc(7,J,4,3,"ng-container",11),s.YNc(8,L,2,1,"ng-container",11),s.qZA(),s.qZA(),s.TgZ(9,"mat-form-field",56),s.TgZ(10,"mat-label"),s._uU(11),s.ALo(12,"translate"),s.qZA(),s.TgZ(13,"textarea",57),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(2).form.text=e}),s.qZA(),s.qZA(),s.BQk()}if(2&t){const t=s.oxw(2);s.xp6(3),s.hij(" ",s.lcZ(4,9,"broadcast.form.target.title")," "),s.xp6(2),s.Q6J("placeholder",s.lcZ(6,11,"broadcast.form.target.title"))("ngModel",t.form.target),s.xp6(2),s.Q6J("ngIf",(null==t.Preq||null==t.Preq.target?null:t.Preq.target.length)<=0),s.xp6(1),s.Q6J("ngIf",(null==t.Preq||null==t.Preq.target?null:t.Preq.target.length)>0),s.xp6(3),s.hij(" ",s.lcZ(12,13,"broadcast.form.content.title")," "),s.xp6(2),s.Q6J("rows",2==t.form.jadwal?16:11)("ngModel",t.form.text)("disabled",1==t.form.finish||1==t.form.processed)}}function j(t,e){if(1&t&&(s.TgZ(0,"div",54),s.YNc(1,I,14,15,"ng-container",11),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngIf",t.form.instance)}}function k(t,e){1&t&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"translate"),s.qZA()),2&t&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"broadcast.form.button_send")," "))}function U(t,e){1&t&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"translate"),s.qZA()),2&t&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"broadcast.form.button_schedule")," "))}let Q=(()=>{class t{constructor(t,e){this.core=t,this.dialogRef=e,this.Com={},this.Busy=!1,this.form={id:"add",delay:1,delay_message:60,rest_every:5,rest_for:5},this.State={},this.Now=n()(new Date)}ngOnInit(){"add"!=this.form.id&&this.extractData(),this.Preq.instance&&1==this.Preq.instance.length&&"demo"!=this.Preq.instance[0].insid&&(this.form.instance=this.Preq.instance[0].insid)}setDate(t){var e=this.form["select_"+t],a=n()(new Date(e)).format("DD-MM-YYYY");this.form[t]=a,this.form[t+"_send"]=n()(new Date(e)).format("YYYY-MM-DD"),delete this.form["select_"+t]}genTime(){this.form.schedule_date=n()(new Date).format("DD-MM-YYYY").toString(),this.form.schedule_time=n()(new Date).add(1,"hour").format("HH:mm:ss")}extractData(){this.core.getStorage({id:this.Name.broadcast,isjson:!0}).then(t=>{if(t&&t.data){let a=l().find(t.data,{id:Number(this.ID)});if(a){let t=[];try{let e=a.target_id.split(",");if(e.length>0)for(let a of e)t.push(Number(a))}catch(e){t=[Number(a.target_id)]}let i=null;this.Duplicate||(i=a.id),this.form={id:i,instance:a.insid,jadwal:a.jadwal,jadwal_time:2==a.jadwal?a.jadwal_time:null,delay:a.delay,delay_message:a.delay_message,rest_every:a.rest_every,rest_for:a.rest_for,target:t,text:a.content}}}})}beforeSubmit(t){if(!this.form.target)return this.core.OpenAlert({header:this.core.translatePipe("broadcast.form.alert.target.header"),msg:`\n                    <div>\n                        ${this.core.translatePipe("broadcast.form.alert.target.msg")}\n                    </div>\n                `}),!1;if(!this.form.text)return this.core.OpenAlert({header:this.core.translatePipe("broadcast.form.alert.text.header"),msg:`\n                    <div>\n                        ${this.core.translatePipe("broadcast.form.alert.text.msg")}\n                    </div>\n                `}),!1;this.form.jadwal_time=n()(this.form.schedule_date,"DD-MM-YYYY").format("YYYY-MM-DD")+" "+this.form.schedule_time;var e=this.form.target[0];this.form.target.length>1&&(e=this.form.target.join(",")),this.form.target_id=e;var a=[];for(let o of this.form.target){var i=l().find(this.Preq.target,{id:o});i&&(a=[...a,...i.data])}a=l().uniqBy(a,"id"),this.form.target_data=JSON.stringify(a),this.form.text_nostrip="[NOSTRIP]"+this.form.text,t()}Submit(){this.Busy||(this.Busy=!0,this.beforeSubmit(()=>{let t="add";"add"==this.form.id||this.Duplicate||(t="edit"),this.core.Do(this.Com.url.def+t,this.form).subscribe(t=>{t&&1==t.status?("add"!=t.id&&(t.form=this.form),this.dialogRef.close(t)):this.Busy=!1},t=>{this.Busy=!1})}))}GetPos(){var t=$("#editor").getCursorPosition();this.CursorPos=t}setSelectionRange(t,e,a){if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,a);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",a),i.moveStart("character",e),i.select()}}setCaretToPos(t,e){this.setSelectionRange(t,e,e)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(r.Q),s.Y36(d.so))},t.\u0275cmp=s.Xpm({type:t,selectors:[["dialog-broadcast"]],decls:33,vars:23,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane",1,"flex","flex-col","md:min-w-160","-m-6x"],["cdkDragHandle","",1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-xl"],["mat-icon-button","","mat-dialog-close","","tabindex","-1",4,"ngIf"],["ngNativeValidate","",1,"overflow-y-auto","max-h-screen","dialog-content-container",3,"ngClass","ngSubmit"],[1,"flex","flex-col","flex-auto","p-4","px-8"],[1,"mb-5","mt-5"],[1,"flex","sm:flex-row","xs:flex-col","flex-auto"],[1,"flex","flex-auto","flex-col"],["appearance","outline","floatLabel","auto",1,"smallx"],["name","instance","required","",3,"placeholder","ngModel","ngModelChange"],[4,"ngIf"],["appearance","outline","floatLabel","auto","class","smallx",4,"ngIf"],["class","flex flex-col flex-auto sm:ml-4 xs:ml-0 md:min-w-100",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","sm:items-center","justify-between","bg-gray-50","p-4","px-6"],[1,""],["mat-dialog-close","","type","button","mat-button","",1,"order-first","sm:order-last"],[1,"icon-size-5","mr-1",3,"svgIcon"],[1,"flex","items-center","mt-4","sm:mt-0"],["mat-flat-button","",1,"order-first","sm:order-last",3,"color","disabled"],[1,"icon-size-5","mr-2",3,"svgIcon"],["mat-icon-button","","mat-dialog-close","","tabindex","-1"],[1,"text-current",3,"svgIcon"],["disabled",""],[3,"value","disabled","class",4,"ngFor","ngForOf"],[3,"value","disabled"],["name","jadwal","required","",3,"placeholder","ngModel","ngModelChange"],[3,"value"],["class","flex flex-auto md:flex-row xs:flex-col",4,"ngIf"],["appearance","outline","floatLabel","auto",1,"smallx",3,"ngClass"],["name","delay",3,"ngModel","ngModelChange"],[3,"value","innerHTML"],["class","text-primary flex flex-row",4,"ngIf"],[1,"flex","flex-row","flex-wrap"],["appearance","outline","floatLabel","auto",1,"smallx","mr-2","max-w-48"],["name","delay_message","matInput","","mask","0*","required","",3,"ngModel","readonly","placeholder","ngModelChange"],["matSuffix",""],["name","rest_every","matInput","","placeholder","5","mask","0*","required","",3,"ngModel","readonly","ngModelChange"],["appearance","outline","floatLabel","auto",1,"smallx","max-w-48"],["name","rest_for","matInput","","placeholder","5","mask","0*","required","",3,"ngModel","readonly","ngModelChange"],[1,"flex","flex-auto","md:flex-row","xs:flex-col"],[1,"sm:mr-6","sm:mt-2","xs:mb-4"],["appearance","outline",1,"smallx","w-full"],["matInput","","placeholder","DD-MM-YYYY","name","schedule_date","required","","mask","d0-M0-0000",3,"ngModel","readonly","leadZeroDateTime","ngModelChange","click"],["hidden","","name","select_schedule_date",3,"matDatepicker","ngModel","min","ngModelChange"],["type","button","mat-icon-button","","matSuffix","","tabindex","-1",3,"click",4,"ngIf"],["schedule_date",""],["appearance","outline","floatLabel","auto",1,"smallx","sm:ml-2"],["name","schedule_time","matInput","","mask","Hh:m0:s0",3,"ngModel","readonly","ngModelChange"],["type","button","mat-icon-button","","matSuffix","","tabindex","-1",3,"click"],["svgIcon","date_range",3,"matDatepicker"],[1,"text-primary","flex","flex-row"],["svgIcon","heroicons_outline:information-circle",1,"icon-size-4","text-primary","mr-1"],[2,"margin-top","1px"],[1,"flex","flex-col","flex-auto","sm:ml-4","xs:ml-0","md:min-w-100"],["name","target","required","","multiple","",3,"placeholder","ngModel","ngModelChange"],["appearance","outline","floatLabel","auto"],["matInput","","required","","name","editor","id","editor",3,"rows","ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"div",2),s._uU(3,"Broadcast Form"),s.qZA(),s.YNc(4,w,2,1,"button",3),s.qZA(),s.TgZ(5,"form",4),s.NdJ("ngSubmit",function(){return e.Submit()}),s.TgZ(6,"div",5),s.TgZ(7,"div",6),s._uU(8),s.ALo(9,"translate"),s.qZA(),s.TgZ(10,"div",7),s.TgZ(11,"div",8),s.TgZ(12,"mat-form-field",9),s.TgZ(13,"mat-label"),s._uU(14),s.ALo(15,"translate"),s.qZA(),s.TgZ(16,"mat-select",10),s.NdJ("ngModelChange",function(t){return e.form.instance=t}),s.ALo(17,"translate"),s.YNc(18,T,4,3,"ng-container",11),s.YNc(19,D,2,1,"ng-container",11),s.qZA(),s.qZA(),s.YNc(20,q,12,15,"mat-form-field",12),s.YNc(21,S,39,42,"ng-container",11),s.qZA(),s.YNc(22,j,2,1,"div",13),s.qZA(),s.qZA(),s.TgZ(23,"div",14),s.TgZ(24,"div",15),s.TgZ(25,"button",16),s._UZ(26,"mat-icon",17),s._uU(27," Close "),s.qZA(),s.qZA(),s.TgZ(28,"div",18),s.TgZ(29,"button",19),s._UZ(30,"mat-icon",20),s.YNc(31,k,3,3,"span",11),s.YNc(32,U,3,3,"span",11),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(4),s.Q6J("ngIf",!e.Busy),s.xp6(1),s.Q6J("ngClass",null!=e.form&&e.form.instance?"xs:bb-20":""),s.xp6(3),s.hij(" ",s.lcZ(9,17,"broadcast.form.title")," "),s.xp6(6),s.hij(" ",s.lcZ(15,19,"broadcast.form.select_instance")," "),s.xp6(2),s.Q6J("placeholder",s.lcZ(17,21,"broadcast.form.select_instance"))("ngModel",e.form.instance),s.xp6(2),s.Q6J("ngIf",(null==e.Preq||null==e.Preq.instance?null:e.Preq.instance.length)<=0),s.xp6(1),s.Q6J("ngIf",(null==e.Preq||null==e.Preq.instance?null:e.Preq.instance.length)>0),s.xp6(1),s.Q6J("ngIf",e.form.instance),s.xp6(1),s.Q6J("ngIf",e.form.jadwal),s.xp6(1),s.Q6J("ngIf",e.form.jadwal),s.xp6(4),s.Q6J("svgIcon","mat_outline:close"),s.xp6(3),s.Q6J("color","primary")("disabled",!e.form.instance),s.xp6(1),s.Q6J("svgIcon","feather:send"),s.xp6(1),s.Q6J("ngIf",2!=e.form.jadwal),s.xp6(1),s.Q6J("ngIf",2==e.form.jadwal))},directives:[c.Zt,c.Bh,f.O5,u.JL,u.F,f.mk,m.oO,g.KE,g.hX,h.gD,u.Q7,u.JJ,u.On,x.lW,d.ZT,p.Hw,Z.ey,f.sg,b.Nt,_.hx,u.Fj,g.R9,v.hl,v.Mq,g.bx],pipes:[A.X$],encapsulation:2}),t})()},21953:(t,e,a)=>{"use strict";a.d(e,{v:()=>T});var i=a(71386),l=a(23815),o=a.n(l),n=a(16738),s=a.n(n),r=a(59096),d=a(37716),c=a(42448),f=a(22238),u=a(51095),m=a(76627),g=a(38583),h=a(12178),x=a(88030),p=a(29790);function Z(t,e){1&t&&d._UZ(0,"mat-progress-bar",10),2&t&&d.Q6J("mode","indeterminate")}function b(t,e){if(1&t&&(d.TgZ(0,"div",25),d.TgZ(1,"div",17),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"div",26),d._uU(5),d.qZA(),d.qZA()),2&t){const t=d.oxw().$implicit,e=d.oxw(2);d.xp6(2),d.hij(" ",d.lcZ(3,2,"broadcast.detail.status.wait")," "),d.xp6(3),d.hij(" ",e.formatDate(null==t?null:t.jadwal_time)," ")}}function _(t,e){1&t&&(d.TgZ(0,"div",25),d.TgZ(1,"div",17),d._uU(2," Status "),d.qZA(),d.TgZ(3,"div",26),d._uU(4," In Progress "),d.qZA(),d.qZA())}function v(t,e){if(1&t&&(d.TgZ(0,"div",25),d.TgZ(1,"div",17),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"div",27),d._uU(5),d.qZA(),d.qZA()),2&t){const t=d.oxw().$implicit,e=d.oxw(2);d.xp6(2),d.hij(" ",d.lcZ(3,2,"broadcast.detail.finish_date")," "),d.xp6(3),d.hij(" ",e.formatDate(null==t?null:t.finish_date)," ")}}function A(t,e){if(1&t){const t=d.EpF();d.ynx(0),d.TgZ(1,"a",14),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).openDetail(e)}),d.TgZ(2,"div",15),d.TgZ(3,"div",16),d.TgZ(4,"div"),d.TgZ(5,"div",17),d._uU(6),d.qZA(),d.TgZ(7,"div",18),d._uU(8),d.qZA(),d.qZA(),d.TgZ(9,"div",19),d.TgZ(10,"div",20),d.TgZ(11,"div",21),d.TgZ(12,"div",17),d._uU(13," Broadcast Type "),d.qZA(),d.TgZ(14,"div",18),d._uU(15),d.qZA(),d.qZA(),d.YNc(16,b,6,4,"div",22),d.YNc(17,_,5,0,"div",22),d.YNc(18,v,6,4,"div",22),d.qZA(),d.qZA(),d.TgZ(19,"div",23),d.TgZ(20,"div",24),d._uU(21," Total Target "),d.qZA(),d.TgZ(22,"div"),d._uU(23),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.BQk()}if(2&t){const t=e.$implicit,a=d.oxw(2);d.xp6(1),d.Q6J("ngClass",t.active?"bg-hover":""),d.xp6(5),d.hij(" ",t.alias?t.alias:t.insid," "),d.xp6(2),d.hij(" ",a.formatDate(null==t?null:t.create_date)," "),d.xp6(7),d.hij(" ",1==t.delay?"Smart Delay":"Manual Timer"," "),d.xp6(1),d.Q6J("ngIf",!t.finish_date&&!t.nextrun_date&&2==t.jadwal),d.xp6(1),d.Q6J("ngIf",!t.finish_date&&t.nextrun_date),d.xp6(1),d.Q6J("ngIf",t.finish_date),d.xp6(5),d.hij(" ",null==t.target_data?null:t.target_data.length," Target ")}}function w(t,e){if(1&t&&(d.TgZ(0,"cdk-virtual-scroll-viewport",11),d.TgZ(1,"div",12),d.YNc(2,A,24,8,"ng-container",13),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.Q6J("itemSize",0),d.xp6(2),d.Q6J("cdkVirtualForOf",t.List)}}let T=(()=>{class t{constructor(t,e,a){this.core=t,this.zone=e,this.dialog=a,this.AllSub={},this.Ready=!1,this.Any={},this.Busy=!1,this.DataExpired=3600,this.Name={broadcast:"broadcast-list",target:"target-list",instance:"inst-list"},this.domList=100,this.Limit=100,this.Count=0,this.Preq={},this.Com={url:{def:"e/broadcast/",target:"e/target/",instance:"e/instance/"}},this.AllList={},this.List=[],this.AllSub.updateDetailed=this.core.getSharing("updateDetailed").subscribe(t=>{if(t&&this.List.length>0){let e=o().find(this.List,{id:t.id}),a=!1;t.finish_date?(a=!0,this.List=[],this.loadData(a)):t.nextrun_date==e.nextrun_date&&t.jadwal_time==e.jadwal_time||(this.List=[],this.loadData())}}),this.AllSub.command=this.core.getSharing("broadcastListCommand").subscribe(t=>{if(t){let e=t.command,a=t.data;"delete"==e?this.Delete(a):"duplicate"==e?this.Duplicate(a):"edit"==e?this.Edit(a):"stop"==e&&this.Stop(a)}})}ngOnInit(){this.loadTarget(()=>{this.loadInstance(()=>{this.loadData()})})}ngOnDestroy(){if(Object.keys(this.AllSub).length>0)for(let t in this.AllSub)this.AllSub[t]&&this.AllSub[t].unsubscribe()}formatDate(t){return s()(t).format("YYYY-MM-DD HH:mm")}loadData(t=!1){this.Busy||(this.Busy=!0,clearTimeout(this.delayLoadData),this.delayLoadData=setTimeout(()=>{let e=this.Name.broadcast;this.AllList[e]||(this.AllList[e]=[]),t?this.execLoadData(t):this.core.getStorage({id:e,isjson:!0}).then(e=>{var a;if(e){var i=e.data,l=s()(e.stamp);s()(new Date).diff(l,"seconds")>this.DataExpired&&(null===(a=this.List)||void 0===a?void 0:a.length)<=0?this.execLoadData(t):this.zone.run(()=>{let t=JSON.parse(JSON.stringify(i.slice(this.List.length,this.List.length+this.domList)));for(let e of t)e.target_data&&this.core.isJSON(e.target_data)&&(e.target_data=JSON.parse(e.target_data));this.List=this.List.length>0?[...this.List,...t]:t,t.length<this.domList&&(this.InfiniteStop=!0),this.List.length<=0&&t.length<=0&&(this.DataUnavailable=!0),this.Busy=!1})}else this.execLoadData(t)})},100))}execLoadData(t){clearTimeout(this.delayLoadData),this.delayLoadData=setTimeout(()=>{this.core.Do(this.Com.url.def+"data",{}).subscribe(e=>{this.Busy=!1,e&&e.data?this.zone.run(()=>{var a=e.data;let i=JSON.parse(JSON.stringify(a.slice(0,this.domList)));for(let t of i)t.target_data&&this.core.isJSON(t.target_data)&&(t.target_data=JSON.parse(t.target_data));this.List=this.List.length>0?[...this.List,...i]:i,i.length<this.domList&&(this.InfiniteStop=!0),i.length<=0&&(this.DataUnavailable=!0),t?(this.AllList[this.Name.broadcast]=[],this.core.removeStorage(this.Name.broadcast).then(()=>{this.updateStorage(a,this.Name.broadcast)})):this.updateStorage(a,this.Name.broadcast)}):(this.InfiniteStop=!0,this.List.length<=0&&(this.DataUnavailable=!0))},t=>{this.Busy=!1})})}updateStorage(t,e=this.Name.broadcast,a=null){this.AllList[e]||(this.AllList[e]=[]),this.core.getStorage({id:e,isjson:!0}).then(i=>{var l;if(i){var o=i.data,n=s()(i.stamp);if(s()(new Date).diff(n,"seconds")>this.DataExpired&&(null===(l=this.List)||void 0===l?void 0:l.length)>0)this.core.setStorage({id:e,isjson:!0},{data:t,stamp:s()(new Date)}).then(()=>{a&&a()});else{var r=[...o,...t];this.AllList[e]=r,this.core.setStorage({id:e,isjson:!0},{data:r,stamp:n}).then(()=>{a&&a()})}}else this.core.setStorage({id:e,isjson:!0},{data:t,stamp:s()(new Date)}).then(()=>{a&&a()}),this.AllList[e]=t})}openDetail(t){let e=o().filter(this.List,{active:!0}),a=!1;for(let i of e)i.id==t.id&&(a=!0),delete i.active;a||(t.active=!0),this.core.sharing("Detail",t)}Refresh(){this.List=[],this.loadData(!0)}openDialog(t={}){const e=this.dialog.open(r.M,{disableClose:!0,panelClass:"event-form-dialog"});e.componentInstance.Preq=this.Preq,e.componentInstance.Name=this.Name,e.componentInstance.Com=this.Com,t.id&&(e.componentInstance.form=t,e.componentInstance.Duplicate=t.duplicate),e.afterClosed().subscribe(e=>{e&&(this.Refresh(),"add"!=e.form.id&&(t.target_data&&(t.target_data=JSON.parse(t.target_data)),t.content=t.text,setTimeout(()=>{this.openDetail(e.form)},100)))})}loadTarget(t){this.core.getStorage({id:this.Name.target,isjson:!0}).then(e=>{if(e)if(e.data){for(let t of e.data)t.data&&(t.data=JSON.parse(t.data));this.Preq.target=e.data,t&&t()}else this.execLoadTarget(t);else this.execLoadTarget(t)})}execLoadTarget(t){if(this.Busy)return!1;this.Busy=!0,this.core.Do(this.Com.url.target+"data",{isbroadcast:1}).subscribe(e=>{if(e&&1==e.status){var a={data:e.data,stamp:s()(new Date)};this.core.setStorage({id:this.Name.target,isjson:!0},a).then(()=>{for(let t of e.data)t.data&&(t.data=JSON.parse(t.data));this.Preq.target=e.data,this.Busy=!1,t&&t()})}else this.Busy=!1,t&&t()},e=>{this.Busy=!1,t&&t()})}loadInstance(t){this.core.getStorage({id:this.Name.instance,isjson:!0}).then(e=>{if(e)if(e.data){var a=[];for(let t of e.data)if("demo"!=t.insid){if(t.info)try{t.info=JSON.parse(t.info)}catch(i){}a.push(t)}this.Preq.instance=a,t&&t()}else this.execLoadInstance(t);else this.execLoadInstance(t)})}execLoadInstance(t){if(this.Busy)return!1;this.Busy=!0,this.core.Do(this.Com.url.instance+"data",{}).subscribe(e=>{if(e&&e.data){var a={data:e.data,stamp:s()(new Date)};this.core.setStorage({id:this.Name.instance,isjson:!0},a).then(()=>{var a=[];for(let t of e.data)e.data.length>1&&"demo"==t.insid||(t.info&&(t.info=JSON.parse(t.info)),a.push(t));this.Preq.instance=a,this.Busy=!1,t&&t()})}else this.Busy=!1,t&&t()},e=>{this.Busy=!1,t&&t()})}Delete(t){this.core.OpenConfirm({title:this.core.translatePipe("broadcast.detail.delete.header"),html:this.core.translatePipe("broadcast.detail.delete.message"),confirmText:this.core.translatePipe("broadcast.detail.delete.ok"),cancelText:this.core.translatePipe("broadcast.detail.delete.cancel")},e=>{e.value&&this.core.Do("e/broadcast/delete",{id:t.id}).subscribe(e=>{e&&1==e.status&&(this.openDetail(t),setTimeout(()=>{this.Refresh()},100))},t=>{})})}Duplicate(t){let e=[];try{let a=t.target_id.split(",");if(a.length>0)for(let t of a)e.push(Number(t))}catch(i){e=[Number(t.target_id)]}const a={id:"add",duplicate:!0,instance:t.insid,jadwal:t.jadwal,delay:t.delay,delay_message:t.delay_message,rest_every:t.rest_every,rest_for:t.rest_for,target:e,text:t.content};2==t.jadwal&&(a.schedule_date=s()(new Date).format("DD-MM-YYYY").toString(),a.schedule_time=s()(new Date).add(1,"hour").format("HH:mm:ss")),this.openDialog(a)}Edit(t){let e=[];try{let a=t.target_id.split(",");if(a.length>0)for(let t of a)e.push(Number(t))}catch(i){e=[Number(t.target_id)]}const a={id:t.id,instance:t.insid,jadwal:t.jadwal,delay:t.delay,delay_message:t.delay_message,rest_every:t.rest_every,rest_for:t.rest_for,target:e,text:t.content};2==t.jadwal&&(a.schedule_date=s()(t.jadwal_time,"YYYY-MM-DD HH:mm:ss").format("DD-MM-YYYY").toString(),a.schedule_time=s()(t.jadwal_time,"YYYY-MM-DD HH:mm:ss").format("HH:mm:ss")),this.openDetail(t),this.openDialog(a)}Stop(t){this.core.OpenConfirm({title:this.core.translatePipe("broadcast.detail.stop.header"),html:this.core.translatePipe("broadcast.detail.stop.message"),confirmText:this.core.translatePipe("broadcast.detail.stop.ok"),cancelText:this.core.translatePipe("broadcast.detail.stop.cancel")},e=>{e.value&&this.core.Do("e/broadcast/stop",{id:t.id}).subscribe(e=>{e&&1==e.status&&(this.openDetail(t),setTimeout(()=>{this.Refresh()},100))},t=>{})})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(c.Q),d.Y36(d.R0b),d.Y36(f.uw))},t.\u0275cmp=d.Xpm({type:t,selectors:[["broadcast-list"]],viewQuery:function(t,e){if(1&t&&d.Gf(i.N7,5),2&t){let t;d.iGM(t=d.CRH())&&(e.virtualScroll=t.first)}},decls:13,vars:4,consts:[[1,"relative","flex","flex-auto","w-full","bg-card","dark:bg-transparent","h-full"],[1,"relative","flex","flex-auto","flex-col","w-full","min-w-0","lg:min-w-90","lg:max-w-90","border-r","z-10"],[1,"relative","flex","flex-0","items-center","justify-between","h-16","px-4","border-b","bg-gray-200","text-gray-700","dark:bg-transparent"],[1,"flex","items-center"],[1,"ml-2","font-semibold","uppercase"],["mat-icon-button","",1,"w-12","h-12","min-h-12",3,"click"],[1,"icon-size-8",3,"svgIcon"],[1,"icon-size-8","text-primary",3,"svgIcon"],["class","absolute inset-x-0 bottom-0 h-0.5","color","accent",3,"mode",4,"ngIf"],["customVirtualScrollStrategy","","class","virtual-container","minBufferPx","1000","maxBufferPx","1500",3,"itemSize",4,"ngIf"],["color","accent",1,"absolute","inset-x-0","bottom-0","h-0.5",3,"mode"],["customVirtualScrollStrategy","","minBufferPx","1000","maxBufferPx","1500",1,"virtual-container",3,"itemSize"],[1,"overflow-y-auto"],[4,"cdkVirtualFor","cdkVirtualForOf"],[1,"relative","flex","border-t","first:border-0","hover:bg-hover","cursor-pointer",3,"ngClass","click"],[1,"flex","flex-col","items-start","justify-start","w-full","py-3","pr-4","pl-5","border-l-4","border-transparent"],[1,"flex","flex-col","w-full"],[1,"mr-2","font-semibold"],[1,"text-sm"],[1,"mt-4"],[1,"flex","flex-auto","flex-row"],[1,"flex","flex-auto","flex-col","mr-2"],["class","flex flex-auto flex-col",4,"ngIf"],[1,"mt-2"],[1,"mr-2","text-sm","font-semibold"],[1,"flex","flex-auto","flex-col"],[1,"text-sm","text-yellow-600"],[1,"text-sm","text-blue-600"]],template:function(t,e){1&t&&(d.TgZ(0,"div",0),d.TgZ(1,"div",1),d.TgZ(2,"div",2),d.TgZ(3,"div",3),d.TgZ(4,"div",4),d._uU(5," Broadcast List "),d.qZA(),d.qZA(),d.TgZ(6,"div",3),d.TgZ(7,"a",5),d.NdJ("click",function(){return e.Refresh()}),d._UZ(8,"mat-icon",6),d.qZA(),d.TgZ(9,"a",5),d.NdJ("click",function(){return e.openDialog()}),d._UZ(10,"mat-icon",7),d.qZA(),d.qZA(),d.YNc(11,Z,1,1,"mat-progress-bar",8),d.qZA(),d.YNc(12,w,3,2,"cdk-virtual-scroll-viewport",9),d.qZA(),d.qZA()),2&t&&(d.xp6(8),d.Q6J("svgIcon","mat_solid:refresh"),d.xp6(2),d.Q6J("svgIcon","mat_solid:add_circle_outline"),d.xp6(1),d.Q6J("ngIf",e.Busy),d.xp6(1),d.Q6J("ngIf",(null==e.List?null:e.List.length)>0))},directives:[u.zs,m.Hw,g.O5,h.pW,i.N7,i.xd,i.x0,g.mk,x.oO],pipes:[p.X$],encapsulation:2}),t})()}}]);